---
name: create-new-game
description: "ä¸ºæœ¬é¡¹ç›®åˆ›å»ºæ–°æ¸¸æˆã€‚å½“ç”¨æˆ·è¦æ±‚æ–°å¢æ¸¸æˆæ—¶ä½¿ç”¨ã€‚åŸºäº dicethrone/summonerwars/smashup ä¸‰ä¸ªæ¸¸æˆçš„çœŸå®æ¨¡å¼ï¼Œåˆ† 6 ä¸ªé˜¶æ®µé€æ­¥å®Œæˆï¼Œæ¯é˜¶æ®µæœ‰æ˜ç¡®éªŒæ”¶æ ‡å‡†ï¼Œä¸å…è®¸è·³é˜¶æ®µã€‚"
---

# åˆ›å»ºæ–°æ¸¸æˆï¼ˆåˆ†é˜¶æ®µå·¥ä½œæµï¼‰

> **æ ¸å¿ƒåŸåˆ™**ï¼šæ¯ä¸ªé˜¶æ®µç‹¬ç«‹å¯éªŒè¯ã€ç‹¬ç«‹å¯æäº¤ã€‚é˜¶æ®µä¹‹é—´ä¸ç•™ TODO ç¼ºå£ã€‚AI å¿…é¡»åœ¨å®Œæˆå½“å‰é˜¶æ®µéªŒæ”¶åæ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚

## å¿…è¯»ç´¢å¼•ï¼ˆå•ä¸€æƒå¨æ¥æºï¼Œé¿å…æœ¬æ–‡æ¡£è¿‡æ—¶ï¼‰

> æœ¬ skill åªåšâ€œåˆ†é˜¶æ®µæµç¨‹ + éªŒæ”¶é—¨ç¦ + æœ€å°é—­ç¯â€ã€‚
> ä»»ä½•**è§„èŒƒ/çº¢çº¿/æœ€ä½³å®è·µ**è‹¥åœ¨ä¸‹åˆ—æ–‡æ¡£ä¸­å·²æœ‰å®šä¹‰ï¼Œå¿…é¡»ä»¥å®ƒä»¬ä¸ºå‡†ï¼›æœ¬ skill ä¸é‡å¤å±•å¼€ã€‚

- æ€»åˆ™ï¼š`AGENTS.md`
- å¼•æ“/ç³»ç»Ÿ/move/commandï¼š`docs/ai-rules/engine-systems.md`
- UI/å¸ƒå±€/ç»„ä»¶ï¼š`docs/ai-rules/ui-ux.md`
- React ç™½å±/æ¸²æŸ“é”™è¯¯/Hook è§„åˆ™ï¼š`docs/ai-rules/golden-rules.md`
- åŠ¨ç”»/ç‰¹æ•ˆï¼š`docs/ai-rules/animation-effects.md`
- å›¾ç‰‡/éŸ³é¢‘èµ„æºæ¥å…¥ï¼š`docs/ai-rules/asset-pipeline.md`
- éŸ³é¢‘ç»†åˆ™ï¼š`docs/audio/audio-usage.md`ï¼ˆæ–°å¢éŸ³é¢‘èµ„äº§æµç¨‹ï¼š`docs/audio/add-audio.md`ï¼‰
- ä¸ç¡®å®šè¯¥è¯»å“ªä»½ï¼š`docs/ai-rules/doc-index.md`

## å‰ç½®ï¼šä¿¡æ¯æ”¶é›†ï¼ˆå¯åŠ¨é—¨ç¦ï¼‰

æ”¶é›†ä»¥ä¸‹ä¿¡æ¯åæ‰èƒ½å¼€å§‹ã€‚**å·²æœ‰ä¿¡æ¯ç›´æ¥ä½¿ç”¨ï¼Œç¼ºå¤±é¡¹å›é—®ç”¨æˆ·ï¼Œä¸çŒœæµ‹**ï¼š

1. **gameId**ï¼ˆå°å†™ï¼Œä¸ç›®å½•åä¸€è‡´ï¼Œå¦‚ `smashup`ï¼‰
2. **ç©å®¶äººæ•°èŒƒå›´**ï¼ˆå¦‚ `[2]`ã€`[2,3,4]`ï¼‰
3. **æ ¸å¿ƒæœºåˆ¶ç®€è¿°**ï¼ˆå¦‚"å¡ç‰Œé©±åŠ¨+åŒºåŸŸæ§åˆ¶"ã€"éª°å­+è§’è‰²æŠ€èƒ½"ã€"æˆ˜æ£‹+å¬å”¤"ï¼‰
4. **æ˜¯å¦éœ€è¦é˜¶æ®µ/æµç¨‹ç³»ç»Ÿ**ï¼ˆå¤šé˜¶æ®µå›åˆåˆ¶ â†’ FlowSystemï¼‰
5. **è§„åˆ™æ–‡æ¡£ä½ç½®**ï¼ˆè‹¥æœ‰ï¼Œå…ˆæ”¾ `rule/` ç›®å½•ä¸‹ï¼‰
6. **i18n æ ‡é¢˜ä¸ç®€ä»‹**ï¼ˆä¸­è‹±æ–‡ï¼‰

**å…ˆæŸ¥å·²æœ‰å­—æ®µ**ï¼šé˜…è¯» `src/games/manifest.types.ts` ç¡®è®¤å¯ç”¨å­—æ®µï¼Œé¿å…é‡å¤è¯¢é—®ã€‚

---

## é˜¶æ®µ 1ï¼šç›®å½•éª¨æ¶ä¸ Manifest è½åœ°

**ç›®æ ‡**ï¼šå»ºç«‹å®Œæ•´ç›®å½•ç»“æ„ä¸æœ€å°å ä½å®ç°ï¼Œ`npm run generate:manifests` å¯æˆåŠŸè¿è¡Œã€‚

### 1.1 åˆ›å»ºç›®å½•ç»“æ„

> **é»˜è®¤æ‹†åˆ†**ï¼šä¸­ç­‰ä»¥ä¸Šå¤æ‚åº¦æ¸¸æˆï¼ˆå‘½ä»¤æ•° â‰¥5 æˆ–æœ‰å¤šé˜¶æ®µå›åˆï¼‰ä»ç¬¬ä¸€å¤©å°±ç”¨æ‹†åˆ†ç»“æ„ã€‚

```
src/games/<gameId>/
  manifest.ts          # æ¸…å•å…ƒæ•°æ®
  game.ts              # å¼•æ“é€‚é…å™¨ç»„è£…ï¼ˆåªåšç»„è£…ï¼Œä¸å†™é€»è¾‘ï¼‰
  Board.tsx            # UI å¸ƒå±€ç»„è£…ï¼ˆé€»è¾‘æ‹†åˆ° hooks/ï¼Œå­ç»„ä»¶æ‹†åˆ° ui/ï¼‰
  thumbnail.tsx        # ç¼©ç•¥å›¾ç»„ä»¶
  tutorial.ts          # æ•™å­¦é…ç½®ï¼ˆå ä½ï¼‰
  audio.config.ts      # éŸ³é¢‘é…ç½®ï¼ˆå ä½ï¼‰
  criticalImageResolver.ts  # å…³é”®å›¾ç‰‡é¢„åŠ è½½ï¼ˆè‹¥æœ‰ç²¾çµå›¾ï¼‰
  domain/
    index.ts           # é¢†åŸŸå†…æ ¸å…¥å£
    types.ts           # re-export barrelï¼ˆå¯¼å‡º core-types + commands + eventsï¼‰
    core-types.ts      # çŠ¶æ€æ¥å£ï¼ˆPlayerState, GameCore, åŸºç¡€ç±»å‹ï¼‰
    commands.ts        # å‘½ä»¤ç±»å‹ + XX_COMMANDS å¸¸é‡
    events.ts          # äº‹ä»¶ç±»å‹ + XX_EVENTS å¸¸é‡
    ids.ts             # é¢†åŸŸ ID å¸¸é‡è¡¨
    utils.ts           # æ¸¸æˆå†…å…±äº«å·¥å…·ï¼ˆä»ç¬¬ä¸€å¤©å°±å»ºç«‹ï¼‰
  rule/
    <æ¸¸æˆå>è§„åˆ™.md     # è§„åˆ™æ–‡æ¡£å ä½
  hooks/               # æ¸¸æˆä¸šåŠ¡ hooks
  ui/                  # æ¸¸æˆ UI å­ç»„ä»¶
  __tests__/
    smoke.test.ts      # å†’çƒŸæµ‹è¯•å ä½
```

### 1.2 manifest.tsï¼ˆå‚è€ƒçœŸå®æ¸¸æˆï¼‰

```ts
import type { GameManifestEntry } from '../manifest.types';

const entry: GameManifestEntry = {
    id: '<gameId>',
    type: 'game',
    enabled: true,
    titleKey: 'games.<gameId>.title',
    descriptionKey: 'games.<gameId>.description',
    category: 'strategy',         // strategy | casual | party | abstract
    playersKey: 'games.<gameId>.players',
    icon: 'ğŸ®',
    thumbnailPath: '<gameId>/thumbnails/cover',
    allowLocalMode: false,        // é»˜è®¤ä»…è”æœº
    playerOptions: [2],           // å¯é€‰ [2,3,4]
    tags: [],                     // dice_driven | card_driven | tactical ç­‰
    bestPlayers: [2],
};

export const <GAME_ID>_MANIFEST: GameManifestEntry = entry;
export default entry;
```

### 1.3 domain ç±»å‹æ–‡ä»¶ï¼ˆé»˜è®¤æ‹†åˆ†ç»“æ„ï¼‰

**core-types.ts** â€” çŠ¶æ€æ¥å£ï¼š
```ts
import type { PlayerId } from '../../../engine/types';
export type GamePhase = 'factionSelect' | 'startTurn' | 'playCards' | ...;
export const PHASE_ORDER: GamePhase[] = [...];
export interface PlayerState { id: PlayerId; /* ... */ }
export interface <GameId>Core {
    players: Record<PlayerId, PlayerState>;
    turnNumber: number;
    gameResult?: { winner?: string; draw?: boolean };
}
```

**commands.ts** â€” å‘½ä»¤ç±»å‹ï¼š
```ts
import type { Command } from '../../../engine/types';
export const XX_COMMANDS = { DO_SOMETHING: 'DO_SOMETHING', ... } as const;
export interface DoSomethingCommand extends Command<'DO_SOMETHING'> { payload: { ... }; }
export type <GameId>Command = DoSomethingCommand | ...;
```

**events.ts** â€” äº‹ä»¶ç±»å‹ï¼š
```ts
import type { GameEvent } from '../../../engine/types';
export const XX_EVENTS = { SOMETHING_DONE: 'SOMETHING_DONE', ... } as const;
export interface SomethingDoneEvent extends GameEvent<'SOMETHING_DONE'> { payload: { ... }; }
export type <GameId>Event = SomethingDoneEvent | ...;
```

**types.ts** â€” re-export barrelï¼š
```ts
export * from './core-types';
export * from './commands';
export * from './events';
```

### 1.4 domain/ids.tsï¼ˆé¢†åŸŸ ID å¸¸é‡è¡¨ï¼‰

æ‰€æœ‰ç¨³å®š ID å¿…é¡»åœ¨æ­¤å®šä¹‰ï¼Œç¦æ­¢å­—ç¬¦ä¸²å­—é¢é‡ã€‚

### 1.5 domain/index.tsï¼ˆé¢†åŸŸå†…æ ¸å ä½ï¼‰

```ts
import type { DomainCore, PlayerId, RandomFn, GameOverResult } from '../../../engine/types';
import type { <GameId>Core } from './types';

export const <GameId>Domain: DomainCore<<GameId>Core> = {
    gameId: '<gameId>',
    setup: (playerIds: PlayerId[], random: RandomFn): <GameId>Core => ({
        // æœ€å°åˆå§‹çŠ¶æ€
        players: Object.fromEntries(playerIds.map(pid => [pid, createPlayerState(pid)])),
        turnNumber: 1,
        // ...å…¶ä»–å¿…è¦å­—æ®µ
    }),
    validate: (state, command) => ({ valid: true }),  // å ä½
    execute: (state, command, random) => [],            // å ä½
    reduce: (core, event) => core,                     // å ä½
    isGameOver: (core) => core.gameResult,
};
```

### 1.6 game.tsï¼ˆå¼•æ“é€‚é…å™¨å ä½ï¼‰

```ts
import { createGameAdapter, createBaseSystems, createFlowSystem } from '../../engine';
import { <GameId>Domain } from './domain';
import type { <GameId>Core } from './domain/types';

// FlowHooks å ä½ï¼ˆé˜¶æ®µ 4 å®ç°ï¼‰
const flowHooks = {
    initialPhase: '<firstPhase>',
    getNextPhase: () => '<firstPhase>',
    getActivePlayerId: ({ state }) => Object.keys(state.core.players)[0],
};

const systems = [
    createFlowSystem<<GameId>Core>({ hooks: flowHooks }),
    ...createBaseSystems<<GameId>Core>(),
];

export const <GameId> = createGameAdapter<<GameId>Core>({
    domain: <GameId>Domain,
    systems,
    minPlayers: 2,
    maxPlayers: 2,
    commandTypes: [],  // é˜¶æ®µ 4 å¡«å……
});

export default <GameId>;
```

### 1.7 Board.tsxï¼ˆæœ€å°å ä½ï¼‰

```tsx
import React from 'react';
import type { GameBoardProps } from '../../engine/transport/protocol';
import type { MatchState } from '../../engine/types';
import type { <GameId>Core } from './domain/types';

type Props = BoardProps<MatchState<<GameId>Core>>;

const <GameId>Board: React.FC<Props> = ({ G, moves, playerID, ctx }) => {
    return <div className="p-4 text-white">
        <h1><gameId> - éª¨æ¶å ä½</h1>
        <pre>{JSON.stringify(G.core, null, 2)}</pre>
    </div>;
};

export default <GameId>Board;
```

### 1.8 å…¶ä»–å ä½æ–‡ä»¶

- **thumbnail.tsx**ï¼šä½¿ç”¨ `ManifestGameThumbnail` ç»„ä»¶
- **tutorial.ts**ï¼šå¯¼å‡ºç©º `TutorialManifest`ï¼ˆ`{ id: '<gameId>-basic', steps: [] }`ï¼‰
- **audio.config.ts**ï¼šå¯¼å‡ºç©º `GameAudioConfig`
- **__tests__/smoke.test.ts**ï¼šéªŒè¯ domain.setup ä¸æŠ¥é”™

### 1.9 èµ„æºç›®å½•

```
public/assets/<gameId>/
  thumbnails/.gitkeep
  images/.gitkeep
```

### 1.10 i18n æ–‡ä»¶

åˆ›å»º `public/locales/zh-CN/game-<gameId>.json` å’Œ `public/locales/en/game-<gameId>.json`ï¼ŒåŒ…å« title/description/playersã€‚

### éªŒæ”¶

```bash
npm run generate:manifests    # æˆåŠŸç”Ÿæˆæ¸…å•
npx vitest run src/games/<gameId>  # å†’çƒŸæµ‹è¯•é€šè¿‡
npm run dev                   # ç¼–è¯‘æ— æŠ¥é”™ï¼ˆæ¸¸æˆå¯åœ¨å¤§å…åˆ—è¡¨çœ‹åˆ°ï¼‰
```

---

## é˜¶æ®µ 1.5ï¼šæœºåˆ¶åˆ†è§£ä¸æ•°æ®ç»“æ„è®¾è®¡ï¼ˆå¼ºåˆ¶å‰ç½®ï¼‰

**ç›®æ ‡**ï¼šåœ¨å½•å…¥æ•°æ®å‰ï¼Œå…ˆå°†æ¸¸æˆæœºåˆ¶åˆ†è§£ä¸ºå¼•æ“åŸè¯­ç»„åˆï¼Œè®¾è®¡é¢å‘ç™¾æ¸¸æˆçš„é€šç”¨æ•°æ®ç»“æ„ï¼Œé¿å…åæœŸé‡æ„ã€‚

### 1.5.1 æœºåˆ¶åˆ†è§£ä¸å¼•æ“åŸè¯­æ˜ å°„ï¼ˆå¼ºåˆ¶ï¼‰

> **æ ¸å¿ƒåŸåˆ™ï¼šé¢å‘ç™¾æ¸¸æˆè®¾è®¡ï¼Œä¸ä¾èµ–ç°æœ‰æ¸¸æˆçš„å…·ä½“å®ç°ã€‚**

å°†æ–°æ¸¸æˆçš„æ ¸å¿ƒæœºåˆ¶åˆ†è§£ä¸ºå¼•æ“åŸè¯­çš„ç»„åˆï¼š

| æœºåˆ¶ç±»åˆ« | æ¸¸æˆä¸­çš„è¡¨ç° | å¼•æ“åŸè¯­æ˜ å°„ | æ˜¯å¦éœ€è¦æ‰©å±• |
|---------|------------|------------|------------|
| **éšæœºæ€§** | éª°å­/æŠ½ç‰Œ/æ´—ç‰Œ | `dice.ts` / `zones.ts` | ? |
| **èµ„æºç®¡ç†** | é­”åŠ›/è¡ŒåŠ¨ç‚¹/é‡‘å¸ | `resources.ts` | ? |
| **çŠ¶æ€æ•ˆæœ** | buff/debuff/æ ‡è®° | `tags.ts` (å±‚æ•°/æŒç»­æ—¶é—´/å±‚çº§åŒ¹é…) | ? |
| **æ•°å€¼ä¿®æ”¹** | æ”»å‡»åŠ›åŠ æˆ/ä¼¤å®³å‡å… | `modifier.ts` (flat/percent/priority) | ? |
| **åŠ¨æ€å±æ€§** | å¯è¢« buff ä¿®æ”¹çš„å±æ€§ | `attribute.ts` (base + modifiers) | ? |
| **èƒ½åŠ›ç³»ç»Ÿ** | æŠ€èƒ½/è¢«åŠ¨/å…‰ç¯ | `ability.ts` (æ³¨å†Œ/æŸ¥æ‰¾/æ‰§è¡Œå™¨) | ? |
| **ç›®æ ‡é€‰æ‹©** | é€‰æ‹©æ•Œäºº/å‹å†›/æ ¼å­ | `target.ts` | ? |
| **æ¡ä»¶åˆ¤æ–­** | è§¦å‘æ¡ä»¶/æ¿€æ´»æ¡ä»¶ | `condition.ts` + `expression.ts` | ? |
| **æ•ˆæœæ‰§è¡Œ** | ä¼¤å®³/æ²»ç–—/ç§»åŠ¨/æŠ½ç‰Œ | `effects.ts` | ? |
| **ç©ºé—´å…³ç³»** | æ£‹ç›˜/ç½‘æ ¼/åŒºåŸŸ | `zones.ts` (grid/stack/hand) | ? |
| **ä¼¤å®³è®¡ç®—** | ä¼¤å®³ä¿®æ­£/é˜²å¾¡/æŠ¤ç”² | `damageCalculation.ts` | ? |

**è¾“å‡ºäº§ç‰©**ï¼š
1. **å¼•æ“åŸè¯­ç»„åˆæ–¹æ¡ˆ**ï¼šåˆ—å‡ºéœ€è¦ä½¿ç”¨çš„ primitives åŠå…¶ç»„åˆæ–¹å¼
2. **ç¼ºå£æ¸…å•**ï¼šåˆ—å‡ºç°æœ‰ primitives æ— æ³•è¦†ç›–çš„æœºåˆ¶ï¼ˆéœ€æ–°å¢æˆ–æ‰©å±•ï¼‰
3. **å¤ç”¨ç­–ç•¥**ï¼šå“ªäº›æœºåˆ¶å¯ä»¥ç›´æ¥ç”¨ç°æœ‰ primitivesï¼Œå“ªäº›éœ€è¦æ¸¸æˆå±‚å°è£…

### 1.5.2 æ•°æ®ç»“æ„è®¾è®¡ï¼ˆå¼ºåˆ¶ï¼‰

> **æ ¸å¿ƒåŸåˆ™ï¼šæ•°æ®ç»“æ„å¿…é¡»æ”¯æŒæœªæ¥æ‰©å±•ï¼Œé¢å‘ç™¾æ¸¸æˆè®¾è®¡ï¼Œç¦æ­¢"å…ˆå½•å…¥å†é‡æ„"ã€‚**

åœ¨å½•å…¥å…·ä½“æ•°æ®å‰ï¼Œå…ˆè®¾è®¡é€šç”¨æ•°æ®ç»“æ„ï¼š

#### å®ä½“ç±»å‹åˆ†æ

åˆ—å‡ºæ¸¸æˆä¸­çš„æ‰€æœ‰å®ä½“ç±»å‹ï¼ˆå¦‚å¡ç‰Œ/å•ä½/éª°å­/èµ„æº/çŠ¶æ€ï¼‰ï¼Œå¯¹æ¯ç§å®ä½“ç±»å‹å›ç­”ï¼š

1. **é¢†åŸŸè¯­ä¹‰**ï¼šè¯¥å®ä½“åœ¨æ¸¸æˆè§„åˆ™ä¸­çš„æ ¸å¿ƒä½œç”¨ï¼ˆå¦‚"å•ä½=å¯ç§»åŠ¨å¯æ”»å‡»çš„æ£‹å­"ï¼‰
2. **å…±æ€§å­—æ®µ**ï¼šæ‰€æœ‰è¯¥ç±»å®ä½“éƒ½æœ‰çš„å­—æ®µï¼ˆå¦‚ id/name/costï¼‰
3. **å˜ä½“å­—æ®µ**ï¼šéƒ¨åˆ†å®ä½“æœ‰çš„å­—æ®µï¼ˆå¦‚ attack/defense/rangeï¼‰
4. **æ‰©å±•æ€§éœ€æ±‚**ï¼šæœªæ¥å¯èƒ½æ–°å¢çš„å­—æ®µï¼ˆå¦‚ rarity/tags/keywordsï¼‰
5. **å¼•ç”¨å…³ç³»**ï¼šè¯¥å®ä½“å¼•ç”¨å“ªäº›å…¶ä»–å®ä½“ï¼ˆå¦‚å¡ç‰Œå¼•ç”¨æŠ€èƒ½ï¼‰
6. **å¼•æ“åŸè¯­æ˜ å°„**ï¼šè¯¥å®ä½“çš„å“ªäº›å±æ€§åº”è¯¥ç”¨å¼•æ“åŸè¯­è¡¨è¾¾ï¼ˆå¦‚ hp ç”¨ `resources.ts`ï¼Œbuff ç”¨ `tags.ts`ï¼‰

#### æ•°æ®ç»“æ„è®¾è®¡æ¨¡æ¿

```ts
// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå­—æ®µä¸å®Œæ•´ï¼Œæœªæ¥éœ€è¦é‡æ„
interface Card {
    id: string;
    name: string;
    cost: number;
}

// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šè€ƒè™‘æ‰©å±•æ€§ï¼Œå­—æ®µå®Œæ•´ï¼Œé¢å‘ç™¾æ¸¸æˆ
interface Card {
    id: string;
    name: string;
    type: 'action' | 'unit' | 'event';  // ç±»å‹åŒºåˆ†ï¼ˆå¿…é¡»ï¼‰
    cost: number;  // è´¹ç”¨ï¼ˆè‹¥æ¸¸æˆæœ‰èµ„æºç³»ç»Ÿï¼‰
    
    // å¯é€‰å­—æ®µï¼ˆæ ¹æ®æ¸¸æˆæœºåˆ¶å†³å®šï¼‰
    rarity?: 'common' | 'rare' | 'epic';  // ç¨€æœ‰åº¦
    tags?: string[];  // æ ‡ç­¾ï¼ˆå¦‚ 'magic' | 'melee'ï¼‰
    abilities?: string[];  // æŠ€èƒ½ ID å¼•ç”¨ï¼ˆä¸åµŒå¥—å¯¹è±¡ï¼‰
    effects?: Effect[];  // æ•ˆæœå®šä¹‰ï¼ˆç»“æ„åŒ–ï¼‰
    
    // è§¦å‘æ¡ä»¶ï¼ˆè‹¥æœ‰ï¼‰
    trigger?: {
        phase?: GamePhase;  // è§¦å‘é˜¶æ®µ
        event?: string;  // è§¦å‘äº‹ä»¶
        condition?: Condition;  // è§¦å‘æ¡ä»¶
    };
    
    // ä½¿ç”¨é™åˆ¶ï¼ˆè‹¥æœ‰ï¼‰
    usageLimit?: {
        perTurn?: number;  // æ¯å›åˆæ¬¡æ•°
        perGame?: number;  // æ¯å±€æ¬¡æ•°
        cooldown?: number;  // å†·å´å›åˆ
    };
    
    // ç›®æ ‡é€‰æ‹©ï¼ˆè‹¥æœ‰ï¼‰
    targeting?: {
        type: 'self' | 'opponent' | 'any_unit' | 'any_cell';
        filter?: Condition;  // ç›®æ ‡è¿‡æ»¤æ¡ä»¶
        count?: number | 'all';  // ç›®æ ‡æ•°é‡
    };
}
```

#### æ•°æ®é©±åŠ¨åæ¨¡å¼æ¸…å•ï¼ˆå¼ºåˆ¶ï¼‰

åœ¨è®¾è®¡æ•°æ®ç»“æ„æ—¶ï¼Œå¿…é¡»é¿å…ä»¥ä¸‹åæ¨¡å¼ï¼š

| åæ¨¡å¼ | é”™è¯¯ç¤ºä¾‹ | æ­£ç¡®åšæ³• | ä¸ºä»€ä¹ˆé”™è¯¯ |
|--------|---------|---------|-----------|
| **ç¡¬ç¼–ç æŠ€èƒ½é€»è¾‘** | `validate()` ä¸­ `switch (abilityId)` æ¯ä¸ªæŠ€èƒ½ä¸€ä¸ª case | æŠ€èƒ½å®šä¹‰åŒ…å« `validation` é…ç½®ï¼Œä½¿ç”¨é€šç”¨éªŒè¯å‡½æ•° | ç¬¬ 100 ä¸ªæ¸¸æˆä¼šæœ‰ 10000 è¡Œ switch |
| **UI çŠ¶æ€æ··å…¥ core** | `core.lastPlayedCard`ï¼ˆçº¯å±•ç¤ºï¼‰ | é€šè¿‡ EventStream ä¼ é€’ç»™ UI | core åº”è¯¥åªåŒ…å«è§„åˆ™åˆ¤å®šéœ€è¦çš„æ•°æ® |
| **äº¤äº’çŠ¶æ€æ··å…¥ core** | `core.pendingAttack`ï¼ˆç­‰å¾…è¾“å…¥ï¼‰ | ä½¿ç”¨ `sys.interaction` | äº¤äº’çŠ¶æ€æ˜¯ç³»ç»Ÿå±‚èŒè´£ï¼Œä¸æ˜¯é¢†åŸŸå±‚ |
| **ç¼ºå°‘ç›®æ ‡å­—æ®µ** | `grantStatus: { statusId, value }` + æ‰§è¡Œå±‚çŒœæµ‹ç›®æ ‡ | `grantStatus: { statusId, value, target: 'opponent' }` | æ•°æ®ä¸å®Œæ•´å¯¼è‡´æ‰§è¡Œå±‚éœ€è¦"çŒœæµ‹" |
| **ç¼ºå°‘è§¦å‘æ¡ä»¶** | æŠ€èƒ½åªæœ‰æ•ˆæœæè¿°ï¼Œè§¦å‘æ¡ä»¶åœ¨ä»£ç é‡Œç¡¬ç¼–ç  | æŠ€èƒ½å®šä¹‰åŒ…å« `trigger: { phase, event }` | è§¦å‘é€»è¾‘åº”è¯¥æ•°æ®é©±åŠ¨ï¼Œä¸æ˜¯ä»£ç é©±åŠ¨ |
| **ç¼ºå°‘ä½¿ç”¨é™åˆ¶** | æŠ€èƒ½åªæœ‰è´¹ç”¨ï¼Œæ²¡æœ‰"æ¯å›åˆä¸€æ¬¡"ç­‰é™åˆ¶ | æŠ€èƒ½å®šä¹‰åŒ…å« `usageLimit: { perTurn: 1 }` | é™åˆ¶è§„åˆ™åº”è¯¥åœ¨æ•°æ®ä¸­å£°æ˜ |
| **å¯¹è±¡åµŒå¥—å¼•ç”¨** | `card.abilities: Ability[]`ï¼ˆåµŒå¥—å¯¹è±¡ï¼‰ | `card.abilities: string[]`ï¼ˆID å¼•ç”¨ï¼‰ | åµŒå¥—å¯¼è‡´æ•°æ®å†—ä½™å’Œæ›´æ–°ä¸ä¸€è‡´ |
| **æ•£è½çš„çŠ¶æ€å­—æ®µ** | `unit.stunned`, `unit.poisoned`, `unit.buffed` | `unit.tags: TagContainer` | ç¬¬ 100 ä¸ªæ¸¸æˆä¼šæœ‰ 100 ç§çŠ¶æ€å­—æ®µ |
| **ad-hoc ä¿®æ­£å­—æ®µ** | `unit.attackBonus`, `unit.defenseBonus` | `unit.attack: Attribute` (base + modifiers) | ä¿®æ­£é€»è¾‘åº”è¯¥ç”¨ modifier ç³»ç»Ÿ |

#### æ•°æ®å®Œæ•´æ€§è‡ªæ£€æ¸…å•ï¼ˆå¼ºåˆ¶ï¼‰

è®¾è®¡å®Œæ•°æ®ç»“æ„åï¼Œé€é¡¹æ£€æŸ¥ï¼š

- [ ] æ‰€æœ‰å®ä½“ç±»å‹éƒ½æœ‰å”¯ä¸€ ID å­—æ®µï¼ˆ`id: string`ï¼‰
- [ ] æ‰€æœ‰å®ä½“ç±»å‹éƒ½æœ‰ç±»å‹åŒºåˆ†å­—æ®µï¼ˆ`type: 'xxx'`ï¼‰
- [ ] æ‰€æœ‰å¼•ç”¨å…³ç³»éƒ½æ˜¯ ID å¼•ç”¨ï¼Œä¸æ˜¯å¯¹è±¡åµŒå¥—
- [ ] æ‰€æœ‰"å¯èƒ½è¢« buff ä¿®æ”¹"çš„æ•°å€¼éƒ½æ˜ å°„åˆ° `Attribute` æˆ– `resources.ts`
- [ ] æ‰€æœ‰"éœ€è¦ç©å®¶é€‰æ‹©"çš„æ“ä½œéƒ½æœ‰ç›®æ ‡é€‰æ‹©è§„åˆ™ï¼ˆ`targeting` å­—æ®µï¼‰
- [ ] æ‰€æœ‰"æœ‰ä½¿ç”¨é™åˆ¶"çš„èƒ½åŠ›éƒ½æœ‰é™åˆ¶å­—æ®µï¼ˆ`usageLimit`ï¼‰
- [ ] æ‰€æœ‰"æœ‰è§¦å‘æ¡ä»¶"çš„æ•ˆæœéƒ½æœ‰è§¦å‘è§„åˆ™ï¼ˆ`trigger` å­—æ®µï¼‰
- [ ] æ‰€æœ‰çŠ¶æ€æ•ˆæœéƒ½æ˜ å°„åˆ° `TagContainer`ï¼Œä¸æ˜¯æ•£è½çš„å¸ƒå°”å­—æ®µ
- [ ] æ‰€æœ‰æ•°å€¼ä¿®æ”¹éƒ½æ˜ å°„åˆ° `modifier.ts`ï¼Œä¸æ˜¯ ad-hoc çš„ `xxxBonus` å­—æ®µ

### 1.5.3 å¼•æ“èƒ½åŠ›ç¼ºå£åˆ†æï¼ˆå¼ºåˆ¶ï¼‰

å¯¹ç…§ `src/engine/primitives/` å’Œ `src/engine/systems/`ï¼Œåˆ—å‡ºï¼š

1. **å¯ç›´æ¥å¤ç”¨**ï¼šå·²æœ‰çš„ primitives/systems å¯ä»¥ç›´æ¥ä½¿ç”¨
2. **éœ€è¦æ‰©å±•**ï¼šå·²æœ‰çš„ primitives/systems éœ€è¦å¢åŠ æ–°åŠŸèƒ½
3. **éœ€è¦æ–°å¢**ï¼šå®Œå…¨æ²¡æœ‰çš„èƒ½åŠ›ï¼Œéœ€è¦æ–°å»º primitive/system

**è¾“å‡ºäº§ç‰©**ï¼š
- å¼•æ“èƒ½åŠ›ç¼ºå£æ¸…å•ï¼ˆMarkdown è¡¨æ ¼ï¼‰
- æ¯ä¸ªç¼ºå£çš„ä¼˜å…ˆçº§ï¼ˆP0 é˜»å¡ / P1 é‡è¦ / P2 å¯å»¶åï¼‰
- æ¯ä¸ªç¼ºå£çš„é¢„è®¡å®ç°é˜¶æ®µï¼ˆé˜¶æ®µ 3 / é˜¶æ®µ 4 / é˜¶æ®µ 6ï¼‰

### 1.5.4 é¢å‘ç™¾æ¸¸æˆçš„è®¾è®¡æ£€æŸ¥ï¼ˆå¼ºåˆ¶ï¼‰

> **æ ¸å¿ƒé—®é¢˜ï¼šå¦‚æœæœªæ¥æœ‰ 100 ä¸ªæ¸¸æˆï¼Œè¿™ä¸ªè®¾è®¡ä¼šä¸ä¼šå¯¼è‡´ä»£ç çˆ†ç‚¸ï¼Ÿ**

å¯¹æ¯ä¸ªè®¾è®¡å†³ç­–ï¼Œé—®è‡ªå·±ï¼š

1. **å¦‚æœæœ‰ 100 ä¸ªæ¸¸æˆï¼Œæ¯ä¸ªæ¸¸æˆéƒ½è¿™æ ·åšï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**
   - âŒ æ¯ä¸ªæ¸¸æˆåœ¨ `validate()` ä¸­åŠ  100 è¡Œ switch â†’ 10000 è¡Œ switch
   - âœ… æ¯ä¸ªæ¸¸æˆåœ¨æ•°æ®ä¸­å£°æ˜éªŒè¯è§„åˆ™ â†’ æ•°æ®é©±åŠ¨ï¼Œä»£ç ä¸å¢é•¿

2. **è¿™ä¸ªå­—æ®µ/é€»è¾‘æ˜¯æ¸¸æˆç‰¹æœ‰çš„ï¼Œè¿˜æ˜¯å¯ä»¥æŠ½è±¡ä¸ºé€šç”¨èƒ½åŠ›ï¼Ÿ**
   - âŒ `core.diceThroneSpecificField` â†’ åªæœ‰ä¸€ä¸ªæ¸¸æˆç”¨
   - âœ… `core.resources: ResourceContainer` â†’ æ‰€æœ‰æ¸¸æˆéƒ½èƒ½ç”¨

3. **è¿™ä¸ªå®ç°æ˜¯å¦ä¾èµ–"å·²æœ‰æ¸¸æˆçš„å…·ä½“å®ç°"ï¼Ÿ**
   - âŒ "å‚è€ƒ DiceThrone çš„ `CombatAbilityManager`" â†’ è€¦åˆå…·ä½“æ¸¸æˆ
   - âœ… "ä½¿ç”¨ `engine/primitives/ability.ts`" â†’ ä¾èµ–é€šç”¨æŠ½è±¡

4. **å¦‚æœè§„åˆ™å˜åŒ–ï¼Œéœ€è¦æ”¹å¤šå°‘åœ°æ–¹ï¼Ÿ**
   - âŒ æ”¹æŠ€èƒ½è§¦å‘æ¡ä»¶éœ€è¦æ”¹ validate/execute/UI ä¸‰å¤„ â†’ æ•£è½é€»è¾‘
   - âœ… åªæ”¹æŠ€èƒ½å®šä¹‰çš„ `trigger` å­—æ®µ â†’ å•ä¸€æ•°æ®æº

### éªŒæ”¶

- æœºåˆ¶åˆ†è§£è¡¨å·²å®Œæˆï¼Œå¼•æ“åŸè¯­æ˜ å°„æ˜ç¡®
- æ•°æ®ç»“æ„è®¾è®¡å·²å®Œæˆï¼Œé€šè¿‡å®Œæ•´æ€§è‡ªæ£€æ¸…å•
- å¼•æ“èƒ½åŠ›ç¼ºå£æ¸…å•å·²è¾“å‡ºï¼Œä¼˜å…ˆçº§æ˜ç¡®
- é¢å‘ç™¾æ¸¸æˆçš„è®¾è®¡æ£€æŸ¥å·²é€šè¿‡ï¼ˆæ— "ä»£ç çˆ†ç‚¸"é£é™©ï¼‰
- ç”¨æˆ·ç¡®è®¤æ•°æ®ç»“æ„è®¾è®¡åˆç†ï¼Œå¯ä»¥å¼€å§‹å½•å…¥

---

## é˜¶æ®µ 2ï¼šæ•°æ®å½•å…¥ï¼ˆè§„åˆ™æ–‡æ¡£ + æ¸¸æˆæ•°æ® + ç±»å‹å®šä¹‰ï¼‰

**ç›®æ ‡**ï¼šå®Œæˆè§„åˆ™æ–‡æ¡£å½•å…¥ã€é™æ€æ¸¸æˆæ•°æ®å½•å…¥ã€æ ¸å¿ƒç±»å‹å®šä¹‰ï¼Œä¸å†™ä¸šåŠ¡é€»è¾‘ã€‚éœ€è¦æ–°å¢å¼•æ“åŸè¯­çš„éƒ¨åˆ†å¯æ ‡è®°å»¶åã€‚

### 2.0 æ•°æ®ç¼ºå¤±å¤„ç†è§„èŒƒï¼ˆå¼ºåˆ¶ï¼‰

> **æ ¸å¿ƒåŸåˆ™ï¼šä¸çŒœæµ‹ã€ä¸ç¼–é€ ã€ä¸è·³è¿‡ã€‚ç¼ºä»€ä¹ˆé—®ä»€ä¹ˆï¼Œé—®æ¸…æ¥šå†å½•ã€‚**

1. **è§„åˆ™æ–‡æ¡£ä¸å®Œæ•´æˆ–æœ‰æ­§ä¹‰æ—¶**ï¼š
   - åˆ—å‡ºå…·ä½“ç¼ºå¤±/æ­§ä¹‰é¡¹ï¼ˆå¦‚"ç«çƒæœ¯çš„ä¼¤å®³æ˜¯3è¿˜æ˜¯3+éª°å­æ•°ï¼Ÿè§„åˆ™ä¹¦ç¬¬Xé¡µæè¿°æ¨¡ç³Š"ï¼‰
   - å›é—®ç”¨æˆ·ç¡®è®¤ï¼Œä¸è‡ªè¡Œæ¨æ–­
   - è‹¥ç”¨æˆ·æš‚æ—¶æ— æ³•ç¡®è®¤ï¼Œæ ‡è®° `// TODO: å¾…ç¡®è®¤ â€” <å…·ä½“é—®é¢˜>`ï¼Œä¸å¡«é»˜è®¤å€¼

2. **æ•°æ®é‡å¤§ã€ç”¨æˆ·åªæä¾›äº†éƒ¨åˆ†æ—¶**ï¼š
   - å…ˆå½•å…¥å·²æœ‰æ•°æ®ï¼Œæ¯æ‰¹å½•å…¥åè¾“å‡º Markdown æ ¸å¯¹è¡¨ï¼ˆå®ä½“å/å…³é”®å±æ€§/æ•°é‡ï¼‰
   - æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·"å·²å½•å…¥ X æ¡ï¼Œè¿˜ç¼º Y æ¡"ï¼Œåˆ—å‡ºç¼ºå¤±æ¸…å•
   - ç”¨æˆ·è¡¥å……åç»§ç»­å½•å…¥ï¼Œä¸ç­‰å…¨éƒ¨æ•°æ®åˆ°é½æ‰å¼€å§‹ï¼ˆå·²æœ‰æ•°æ®å…ˆè½åœ°ï¼‰

3. **ç´ ææ•°æ®æ ¸å¯¹ï¼ˆå¼ºåˆ¶ï¼Œéµå¾ª AGENTS.mdï¼‰**ï¼š
   - æ ¹æ®å›¾ç‰‡/è§„åˆ™ä¹¦æå–æ•°æ®æ—¶ï¼Œå¿…é¡»å…¨å£å¾„æ ¸å¯¹ã€é€»è¾‘åºåˆ—åŒ–
   - å…³é”®é™å®šè¯æ˜¾å¼æ ¸å¯¹ï¼ˆå¦‚"æ¯å›åˆä¸€æ¬¡"vs"æ¯åœºä¸€æ¬¡"ã€"ç›¸é‚»"vs"åŒè¡Œ"ï¼‰
   - è¾“å‡º Markdown è¡¨æ ¼ä½œä¸ºæ ¸å¯¹å¥‘çº¦ï¼Œç”¨æˆ·ç¡®è®¤åæ‰ç®—å½•å…¥å®Œæˆ

4. **éœ€è¦æ–°å¢å¼•æ“åŸè¯­çš„æ•°æ®**ï¼š
   - è‹¥æŸäº›æ¸¸æˆæœºåˆ¶åœ¨ `src/engine/primitives/` ä¸­æ²¡æœ‰ç°æˆå®ç°
   - å…ˆåœ¨æ•°æ®å±‚æ ‡è®° `// DEFERRED: éœ€æ–°å¢å¼•æ“åŸè¯­ <xxx>ï¼Œæš‚ç”¨å ä½`
   - è®°å½•åˆ°é˜¶æ®µéªŒæ”¶çš„"å»¶åæ¸…å•"ä¸­ï¼Œåœ¨é˜¶æ®µ3æˆ–é˜¶æ®µ4è¡¥å……å®ç°
   - ä¸å› ç¼ºå°‘åŸè¯­è€Œé˜»å¡æ•´ä¸ªæ•°æ®å½•å…¥æµç¨‹

### 2.1 å½•å…¥è§„åˆ™æ–‡æ¡£

å°†è§„åˆ™ä¹¦/è§„åˆ™å›¾ç‰‡å†…å®¹ç»“æ„åŒ–å½•å…¥ `src/games/<gameId>/rule/` ä¸‹çš„ Markdown æ–‡ä»¶ï¼Œæ‹†è§£ä¸ºï¼š

1. **é˜¶æ®µæµç¨‹**ï¼šå›åˆç»“æ„ã€é˜¶æ®µé¡ºåºã€é˜¶æ®µé—´åˆ‡æ¢æ¡ä»¶
2. **æ ¸å¿ƒå®ä½“**ï¼šå¡ç‰Œ/å•ä½/éª°å­/èµ„æºçš„ç±»å‹ä¸å±æ€§
3. **æ“ä½œç±»å‹**ï¼šç©å®¶å¯æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¦‚å‡ºç‰Œ/ç§»åŠ¨/æ”»å‡»/å¼ƒç‰Œï¼‰
4. **ç»“ç®—è§„åˆ™**ï¼šç§¯åˆ†/ä¼¤å®³/èƒœåˆ©æ¡ä»¶
5. **ç‰¹æ®Šæœºåˆ¶**ï¼šå¦‚ faction é€‰æ‹©ã€deck buildingã€æŠ€èƒ½è§¦å‘

**è§„åˆ™æ–‡æ¡£è´¨é‡è¦æ±‚**ï¼š
- æ¯æ¡è§„åˆ™å¿…é¡»å¯è¿½æº¯åˆ°è§„åˆ™ä¹¦åŸæ–‡ä½ç½®ï¼ˆé¡µç /ç« èŠ‚ï¼‰
- æ•°å€¼å¿…é¡»ç²¾ç¡®ï¼ˆ"3ç‚¹ä¼¤å®³"è€Œé"ä¸€äº›ä¼¤å®³"ï¼‰
- æ¡ä»¶è§¦å‘å¿…é¡»å®Œæ•´ï¼ˆè§¦å‘æ—¶æœº + è§¦å‘æ¡ä»¶ + æ•ˆæœ + æŒç»­æ—¶é—´ï¼‰

### 2.2 å½•å…¥æ¸¸æˆé™æ€æ•°æ®

æ ¹æ®è§„åˆ™æ–‡æ¡£ï¼Œå°†æ‰€æœ‰å®ä½“æ•°æ®å½•å…¥ä»£ç ã€‚**ä¸åªæ˜¯åç§°+æè¿°ï¼Œå¿…é¡»å½•å…¥å½±å“æ¸¸æˆæœºåˆ¶çš„å…¨éƒ¨å¿…è¦ä¿¡æ¯**ã€‚

#### "å¿…è¦ä¿¡æ¯"åˆ¤æ–­åŸåˆ™ï¼ˆå¼ºåˆ¶ï¼‰

> æœªæ¥çš„æ¸¸æˆæœºåˆ¶ä¸å¯é¢„çŸ¥ï¼Œä¸é¢„è®¾å…·ä½“å­—æ®µæ¸…å•ã€‚ç”¨ä»¥ä¸‹åŸåˆ™åˆ¤æ–­ä¸€æ¡ä¿¡æ¯æ˜¯å¦å¿…é¡»å½•å…¥ï¼š

1. **è§„åˆ™åˆ¤å®šä¾èµ–**ï¼šå¦‚æœ `validate()` / `execute()` / `reduce()` / `isGameOver()` éœ€è¦è¯»å–è¯¥ä¿¡æ¯æ¥åšå†³ç­–ï¼Œåˆ™å¿…é¡»å½•å…¥ã€‚
   - ä¾‹ï¼šæ”»å‡»åŠ›ã€ç”Ÿå‘½å€¼ã€è´¹ç”¨ã€å°„ç¨‹ã€è§¦å‘æ¡ä»¶ã€æ•ˆæœæ•°å€¼ã€å†·å´å›åˆã€ä½¿ç”¨é™åˆ¶
2. **çŠ¶æ€åŒºåˆ†ä¾èµ–**ï¼šå¦‚æœè¯¥ä¿¡æ¯ç”¨äºåŒºåˆ†ä¸åŒå®ä½“çš„è¡Œä¸ºå·®å¼‚ï¼Œåˆ™å¿…é¡»å½•å…¥ã€‚
   - ä¾‹ï¼šè¿‘æˆ˜vsè¿œç¨‹ã€ä¸€æ¬¡æ€§vsæŒç»­ã€ä¸»åŠ¨vsè¢«åŠ¨ã€é˜µè¥å½’å±
3. **UI æ¸²æŸ“ä¾èµ–**ï¼šå¦‚æœç•Œé¢éœ€è¦è¯¥ä¿¡æ¯æ¥æ­£ç¡®å±•ç¤ºå®ä½“ï¼Œåˆ™å¿…é¡»å½•å…¥ã€‚
   - ä¾‹ï¼šç²¾çµå›¾ç´¢å¼•/å›¾é›†åæ ‡ã€ç´ ææ–‡ä»¶å¼•ç”¨ã€ç‰ŒèƒŒç¬¦å·ã€ä¸­è‹±æ–‡åç§°
4. **å¼•ç”¨å…³ç³»ä¾èµ–**ï¼šå¦‚æœè¯¥ä¿¡æ¯å»ºç«‹å®ä½“é—´çš„å¼•ç”¨é“¾ï¼ˆAæ‹¥æœ‰Bã€Aè§¦å‘Bï¼‰ï¼Œåˆ™å¿…é¡»å½•å…¥ã€‚
   - ä¾‹ï¼šæŠ€èƒ½IDåˆ—è¡¨ã€æ•ˆæœå¼•ç”¨ã€ç›®æ ‡é€‰æ‹©è§„åˆ™
5. **æ•°é‡/åˆ†å¸ƒä¾èµ–**ï¼šå¦‚æœè¯¥ä¿¡æ¯å½±å“æ¸¸æˆçš„éšæœºæ€§æˆ–èµ„æºåˆ†é…ï¼Œåˆ™å¿…é¡»å½•å…¥ã€‚
   - ä¾‹ï¼šç‰Œç»„ä¸­çš„æ•°é‡ã€éª°é¢åˆ†å¸ƒã€åˆå§‹èµ„æº

**åé¢åˆ¤æ–­â€”â€”å¯ä»¥ä¸å½•å…¥çš„**ï¼š
- çº¯é£å‘³æ–‡æœ¬ï¼ˆä¸å½±å“ä»»ä½•è§„åˆ™åˆ¤å®šçš„èƒŒæ™¯æ•…äº‹ï¼‰
- å¯ä»å…¶ä»–å·²å½•å…¥æ•°æ®æ¨å¯¼å‡ºçš„å†—ä½™ä¿¡æ¯
- ä»…åœ¨å¼€å‘è°ƒè¯•æ—¶ä½¿ç”¨ã€ä¸è¿›å…¥ç”Ÿäº§çš„ä¸´æ—¶æ ‡è®°

#### å½•å…¥å®Œæ•´æ€§è‡ªæ£€ï¼ˆé€å­—æ®µï¼Œå¼ºåˆ¶ï¼‰

> **æ ¸å¿ƒé—®é¢˜ï¼šç´ æ/è§„åˆ™ä¹¦ä¸Šçš„æ¯ä¸€æ¡ä¿¡æ¯ï¼Œæ˜¯å¦éƒ½å·²åœ¨ä»£ç ä¸­æœ‰å¯¹åº”å­—æ®µï¼Ÿ**
> AI å®¹æ˜“æ¼å½•"ä¸å¥½ç»“æ„åŒ–"çš„ä¿¡æ¯ï¼ˆå¦‚å›¾æ ‡è¡¨ç¤ºçš„è§¦å‘æ¡ä»¶ã€ç¬¦å·è¡¨ç¤ºçš„éª°é¢ç»„åˆï¼‰ã€‚å¿…é¡»é€é¡¹æ ¸å¯¹ï¼Œä¸èƒ½åªå½•"å¥½å½•çš„"ã€‚

æ¯å½•å…¥ä¸€ä¸ªå®ä½“ç±»å‹ï¼Œæ‰§è¡Œä»¥ä¸‹è‡ªæ£€ï¼š

1. **ç´ æå…¨ä¿¡æ¯æå–**ï¼šå°†ç´ æï¼ˆå¡ç‰Œå›¾ç‰‡/è§„åˆ™ä¹¦æ¡ç›®ï¼‰ä¸Šçš„æ‰€æœ‰å¯è§ä¿¡æ¯é€æ¡åˆ—å‡ºï¼ŒåŒ…æ‹¬ï¼š
   - æ–‡å­—ä¿¡æ¯ï¼ˆåç§°ã€æè¿°ã€æ•°å€¼ï¼‰
   - å›¾æ ‡/ç¬¦å·ä¿¡æ¯ï¼ˆéª°é¢å›¾æ ‡ã€å…ƒç´ ç¬¦å·ã€é˜µè¥æ ‡è®°ï¼‰â†’ å¿…é¡»è½¬åŒ–ä¸ºç»“æ„åŒ–æ•°æ®
   - ä½ç½®/å¸ƒå±€éšå«ä¿¡æ¯ï¼ˆå¡ç‰Œåˆ†åŒºæš—ç¤ºçš„é˜¶æ®µå½’å±ã€é¢œè‰²æš—ç¤ºçš„ç¨€æœ‰åº¦ï¼‰
2. **é€æ¡æ¯”å¯¹**ï¼šå°†æå–çš„ä¿¡æ¯åˆ—è¡¨ä¸å·²å®šä¹‰çš„ TypeScript å­—æ®µé€æ¡æ¯”å¯¹ï¼Œç¡®è®¤æ¯æ¡ä¿¡æ¯éƒ½æœ‰å¯¹åº”å­—æ®µæ‰¿æ¥
3. **ç¼ºå­—æ®µç«‹å³è¡¥**ï¼šå‘ç°ç´ æä¸Šæœ‰ä¿¡æ¯ä½†ä»£ç ä¸­æ— å¯¹åº”å­—æ®µ â†’ è¡¥å­—æ®µï¼Œä¸è·³è¿‡
4. **å¼•ç”¨å®Œæ•´æ€§**ï¼šè¯¥å®ä½“å¼•ç”¨çš„å…¶ä»–å®ä½“ ID æ˜¯å¦éƒ½å·²å®šä¹‰ï¼Ÿï¼ˆæ–­é“¾ â†’ è¡¥æˆ–æ ‡è®° TODOï¼‰

**å…¸å‹æ¼å½•åœºæ™¯ï¼ˆè­¦ç¤ºï¼‰**ï¼š
- âŒ æŠ€èƒ½å¡åªå½•äº†åç§°+æ•ˆæœæè¿°ï¼Œæ¼äº†è§¦å‘éª°é¢ç»„åˆ â†’ `validate()` æ— æ³•åˆ¤æ–­è§¦å‘æ¡ä»¶
- âŒ å•ä½å¡åªå½•äº†æ”»å‡»åŠ›+ç”Ÿå‘½å€¼ï¼Œæ¼äº†ç§»åŠ¨èŒƒå›´ â†’ æ£‹ç›˜äº¤äº’æ— æ³•æ ¡éªŒåˆæ³•ç§»åŠ¨
- âŒ å¡ç‰Œåªå½•äº†æ•ˆæœæ–‡æœ¬ï¼Œæ¼äº†è´¹ç”¨/å†·å´ â†’ èµ„æºæ¶ˆè€—é€»è¾‘æ— æ•°æ®æº

#### ç›®å½•ç»“æ„é€‰æ‹©

æŒ‰æ¸¸æˆå¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ•°æ®ç»„ç»‡æ–¹å¼ï¼š

**ç®€å•æ¸¸æˆ**ï¼šç›´æ¥åœ¨ domain ä¸­å®šä¹‰ã€‚

**ä¸­ç­‰æ¸¸æˆ**ï¼š
```
data/
  cards.ts           # å®ä½“å®šä¹‰ä¸æŸ¥è¯¢å‡½æ•°
  factions/          # æŒ‰åˆ†ç»„ç»„ç»‡æ•°æ®
```

**å¤æ‚æ¸¸æˆ**ï¼š
```
config/ æˆ– heroes/   # æŒ‰å®ä½“å¤§ç±»æ‹†åˆ†
  factions/          # æŒ‰é˜µè¥/è§’è‰²è¿›ä¸€æ­¥æ‹†åˆ†
```

å…·ä½“ç›®å½•åå’Œæ–‡ä»¶æ‹†åˆ†æ–¹å¼ç”±æ¸¸æˆçš„å®ä½“ç»“æ„å†³å®šï¼Œä¸é¢„è®¾ã€‚

#### å½•å…¥æµç¨‹

1. æŒ‰å®ä½“ç±»åˆ«åˆ†æ‰¹å½•å…¥ï¼ˆå¦‚å…ˆå½•åŸºç¡€å®ä½“ï¼Œå†å½•ä¾èµ–å®ƒä»¬çš„å¤åˆå®ä½“ï¼‰
2. æ¯æ‰¹å½•å…¥åè¾“å‡ºæ ¸å¯¹è¡¨ï¼Œ**æ ¸å¯¹è¡¨çš„åˆ—å¿…é¡»è¦†ç›–è¯¥å®ä½“ç±»å‹çš„æ‰€æœ‰å¿…è¦å­—æ®µï¼Œä¸åªæ˜¯åç§°**
   - åˆ—çš„é€‰æ‹©ä¾æ®ï¼šä¸Šè¿°"å¿…è¦ä¿¡æ¯åˆ¤æ–­åŸåˆ™"ä¸­å‘½ä¸­çš„å­—æ®µ
   - æ•°å€¼å­—æ®µç›´æ¥åˆ—å‡ºæ•°å€¼ï¼Œå¼•ç”¨å­—æ®µåˆ—å‡ºå¼•ç”¨ç›®æ ‡ï¼Œå¸ƒå°”/æšä¸¾å­—æ®µåˆ—å‡ºå–å€¼
   - æœ€åä¸€åˆ—æ ‡æ³¨å½•å…¥çŠ¶æ€ï¼ˆâœ… å·²å½•å…¥ / âŒ ç¼ºæ•°æ® / âš ï¸ å¾…ç¡®è®¤ï¼‰
3. ç”¨æˆ·ç¡®è®¤æ ¸å¯¹è¡¨åï¼Œè¯¥æ‰¹æ•°æ®è§†ä¸º"å·²éªŒæ”¶"
4. æ‰€æœ‰ç¨³å®š ID å½•å…¥ `domain/ids.ts`ï¼ˆ`as const`ï¼‰ï¼Œç¦æ­¢å­—ç¬¦ä¸²å­—é¢é‡
5. **å…¨é‡æ•°æ®ç¡®è®¤ï¼ˆé˜¶æ®µé—¨ç¦ï¼‰**ï¼šæ‰€æœ‰æ‰¹æ¬¡å½•å…¥å®Œæˆåï¼Œè¾“å‡ºä¸€ä»½æ±‡æ€»æ¸…å•ï¼ŒåŒ…å«ï¼š
   - å„å®ä½“ç±»åˆ«çš„æ•°é‡ç»Ÿè®¡ï¼ˆå¦‚"å•ä½ 24 å¼ ã€æŠ€èƒ½ 18 ä¸ªã€äº‹ä»¶ 12 ç§"ï¼‰
   - ä»æœ‰ `TODO: å¾…ç¡®è®¤` çš„æ¡ç›®åˆ—è¡¨
   - æ ‡è®° `DEFERRED` çš„å¼•æ“åŸè¯­éœ€æ±‚åˆ—è¡¨
   - ç”¨æˆ·æ˜ç¡®å›å¤"ç¡®è®¤"åæ‰å¯è¿›å…¥é˜¶æ®µ 3ï¼Œå¦åˆ™ç»§ç»­è¡¥å……

### 2.3 å®Œå–„ç±»å‹å®šä¹‰

æ ¹æ®å½•å…¥çš„æ•°æ®ï¼Œè¡¥å…… domain/types.tsï¼ˆæˆ–æ‹†åˆ†æ–‡ä»¶ï¼‰ï¼š
- å®Œæ•´çš„ `PlayerState`ï¼ˆæ ¹æ®æ¸¸æˆéœ€è¦çš„çŠ¶æ€å­—æ®µï¼‰
  - **çŠ¶æ€æ•ˆæœå»ºè®®ç”¨ `TagContainer` è¡¨è¾¾**ï¼ˆ`engine/primitives/tags.ts`ï¼‰ï¼Œé¿å…æ•£è½çš„ `statusEffects: Record<string, number>` / `tempAbilities: string[]`
- å®Œæ•´çš„ `<GameId>Core`ï¼ˆç©å®¶çŠ¶æ€/å›åˆä¿¡æ¯/æ¸¸æˆç‰¹æœ‰çŠ¶æ€ç­‰ï¼‰
- æ‰€æœ‰å‘½ä»¤ç±»å‹ï¼ˆ`XX_COMMANDS` å¸¸é‡å¯¹è±¡ï¼‰
- æ‰€æœ‰äº‹ä»¶ç±»å‹ï¼ˆ`XX_EVENTS` å¸¸é‡å¯¹è±¡ï¼‰
- å®ä½“å®šä¹‰çš„ TypeScript æ¥å£

### 2.4 æ£€æŸ¥ç³»ç»Ÿéœ€æ±‚ä¸å¼•æ“åŸè¯­é€‰å‹

å¯¹ç…§è§„åˆ™ï¼Œåœ¨å¼•æ“å±‚æ£€ç´¢å¯å¤ç”¨å®ç°ï¼š
- éª°å­ â†’ `src/engine/primitives/dice.ts`
- èµ„æºï¼ˆæ¶ˆè€—å“ï¼‰â†’ `src/engine/primitives/resources.ts`
- çŠ¶æ€/buff/debuffï¼ˆå±‚æ•°/æŒç»­æ—¶é—´/å‡€åŒ–/å±‚çº§åŒ¹é…ï¼‰â†’ `src/engine/primitives/tags.ts`
- æ•°å€¼ä¿®æ”¹ç®¡çº¿ï¼ˆflat/percent/override/compute + priorityï¼‰â†’ `src/engine/primitives/modifier.ts`
- å¯è¢« buff ä¿®æ”¹çš„å±æ€§ï¼ˆbase + modifier â†’ currentï¼‰â†’ `src/engine/primitives/attribute.ts`
- èƒ½åŠ›ç³»ç»Ÿéª¨æ¶ï¼ˆæ³¨å†Œ/æŸ¥æ‰¾/æ‰§è¡Œå™¨åˆ†å‘/å¯ç”¨æ€§æ£€æŸ¥ï¼‰â†’ `src/engine/primitives/ability.ts`
- å¡ç‰Œ/åŒºåŸŸ â†’ `src/engine/primitives/zones.ts`
- æ¡ä»¶/è¡¨è¾¾å¼ â†’ `src/engine/primitives/condition.ts` + `expression.ts`
- ç›®æ ‡è§£æ â†’ `src/engine/primitives/target.ts`
- æ•ˆæœæ‰§è¡Œ â†’ `src/engine/primitives/effects.ts`

**å¼ºåˆ¶è¦æ±‚ï¼ˆæ–°æ¸¸æˆï¼‰**ï¼š
- ç¦æ­¢è‡ªè¡Œå®ç° statusEffects / tempAbilities / DamageModifier / PowerModifierFn / abilityRegistryï¼›å¿…é¡»å¤ç”¨ä¸Šè¿° primitivesï¼ˆè¯¦è§ `AGENTS.md` ä¸ `docs/ai-rules/engine-systems.md`ï¼‰ã€‚

**è‹¥ç¼ºå£å­˜åœ¨**ï¼šä¼˜å…ˆè¡¥å…… `src/engine/primitives/`ï¼ˆé€šç”¨å·¥å…·å‡½æ•°ï¼‰ï¼›é¢†åŸŸè¯­ä¹‰æ”¾åœ¨æ¸¸æˆå±‚ï¼ˆ`src/games/<gameId>/domain/`ï¼‰ã€‚è‹¥å·¥ä½œé‡å¤§ï¼Œè®°å…¥å»¶åæ¸…å•ï¼Œåœ¨åç»­é˜¶æ®µè¡¥å……ã€‚

### 2.5 é¢†åŸŸå»ºæ¨¡å‰ç½®å®¡æŸ¥ï¼ˆå¼ºåˆ¶é—¨ç¦ï¼‰

> å®Œæ•´è§„èŒƒè§ `docs/ai-rules/engine-systems.md`ã€Œé¢†åŸŸå»ºæ¨¡å‰ç½®å®¡æŸ¥ã€èŠ‚ã€‚
> æ ¸å¿ƒåŸåˆ™ï¼š**è§„åˆ™æ–‡æœ¬ â†’ é¢†åŸŸæ¨¡å‹ â†’ å®ç°**ï¼Œç¦æ­¢è·³è¿‡å»ºæ¨¡ç›´æ¥å†™å®ç°ã€‚

1. **é¢†åŸŸæ¦‚å¿µå»ºæ¨¡**ï¼šä¸ºæ¯ä¸ªè§„åˆ™æœ¯è¯­å®šä¹‰ç²¾ç¡®è¯­ä¹‰è¾¹ç•Œå’Œäº‹ä»¶æ˜ å°„ï¼ˆå¦‚"å½±å“"= å“ªäº›å…·ä½“äº‹ä»¶ï¼‰ã€‚
2. **å†³ç­–ç‚¹è¯†åˆ«**ï¼šæ ‡è®°æ‰€æœ‰éœ€è¦ç©å®¶é€‰æ‹©çš„ç‚¹ï¼ˆå¼ºåˆ¶/å¯é€‰/æ— ï¼‰ï¼Œè¯„ä¼°å¼•æ“æ˜¯å¦æ”¯æŒè¯¥äº¤äº’æ¨¡å¼ã€‚
3. **å¼•æ“èƒ½åŠ›ç¼ºå£åˆ†æ**ï¼šå»ºæ¨¡äº§å‡ºä¸å¼•æ“èƒ½åŠ›é€ä¸€æ¯”å¯¹ï¼Œåˆ—å‡ºç¼ºå£å’Œæ‰©å±•è®¡åˆ’ã€‚

äº§å‡ºï¼šæœ¯è¯­â†’äº‹ä»¶æ˜ å°„è¡¨ + å†³ç­–ç‚¹æ¸…å• + å¼•æ“ç¼ºå£æ¸…å•ã€‚

### éªŒæ”¶

- è§„åˆ™æ–‡æ¡£å®Œæ•´å½•å…¥ `rule/*.md`ï¼Œè¦†ç›–æ‰€æœ‰é˜¶æ®µ/å®ä½“/æ“ä½œ/ç»“ç®—/ç‰¹æ®Šæœºåˆ¶
- é™æ€æ•°æ®å…¨éƒ¨å½•å…¥ä»£ç ï¼Œæ ¸å¯¹è¡¨å·²è·ç”¨æˆ·ç¡®è®¤
- types.ts ä¸­æ‰€æœ‰ç±»å‹èƒ½è¦†ç›–è§„åˆ™æ–‡æ¡£æè¿°çš„å®ä½“
- ids.ts å¸¸é‡è¡¨è¦†ç›–æ‰€æœ‰ç¨³å®š ID
- æ•°æ®æ–‡ä»¶å¯æ­£å¸¸å¯¼å…¥ï¼Œæ— å¾ªç¯ä¾èµ–
- å†’çƒŸæµ‹è¯•ä»é€šè¿‡
- **é¢†åŸŸå»ºæ¨¡å®¡æŸ¥å·²å®Œæˆ**ï¼ˆæœ¯è¯­æ˜ å°„è¡¨/å†³ç­–ç‚¹æ¸…å•/å¼•æ“ç¼ºå£æ¸…å•ï¼‰
- **å»¶åæ¸…å•**ï¼ˆè‹¥æœ‰ï¼‰ï¼šåˆ—å‡ºéœ€è¦æ–°å¢å¼•æ“åŸè¯­çš„é¡¹ç›®åŠé¢„è®¡è¡¥å……é˜¶æ®µ

---

## é˜¶æ®µ 3ï¼šé¢†åŸŸå†…æ ¸å®ç°ï¼ˆCommand â†’ Event â†’ Reduceï¼‰

**ç›®æ ‡**ï¼šå®Œæˆç¡®å®šæ€§æ ¸å¿ƒé€»è¾‘ï¼Œæµ‹è¯•é€šè¿‡ã€‚

### 3.1 å®ç° validateï¼ˆå‘½ä»¤æ ¡éªŒï¼‰

```ts
// domain/commands.ts æˆ– domain/validate.ts
export function validate(state: MatchState<Core>, command: Command): ValidationResult {
    // 1. æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç©å®¶çš„å›åˆ
    // 2. æ£€æŸ¥å½“å‰é˜¶æ®µæ˜¯å¦å…è®¸æ­¤å‘½ä»¤
    // 3. æ£€æŸ¥å‘½ä»¤å‚æ•°åˆæ³•æ€§
    // 4. æ£€æŸ¥èµ„æº/æ¡ä»¶æ˜¯å¦æ»¡è¶³
}
```

**ä¸‰ä¸ªæ¸¸æˆå…±åŒæ¨¡å¼**ï¼š
- dicethrone: `domain/commands.ts` â†’ `validateCommand()`
- summonerwars: `domain/validate.ts` â†’ `validateCommand()`
- smashup: `domain/commands.ts` â†’ `validate()`

### 3.2 å®ç° executeï¼ˆç”Ÿæˆäº‹ä»¶ï¼‰

```ts
// domain/execute.ts æˆ– domain/reducer.ts
export function execute(state: MatchState<Core>, command: Command, random?: RandomFn): GameEvent[] {
    // æ ¹æ® command.type åˆ†å‘å¤„ç†
    // è¿”å›ä¸€ç³»åˆ—äº‹ä»¶ï¼ˆä¸ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼‰
}
```

### 3.3 å®ç° reduceï¼ˆåº”ç”¨äº‹ä»¶åˆ°çŠ¶æ€ï¼‰

```ts
// domain/reducer.ts
export function reduce(core: Core, event: GameEvent): Core {
    switch (event.type) {
        case 'DAMAGE_DEALT': {
            // âœ… ç»“æ„å…±äº«ï¼šåª spread å˜æ›´è·¯å¾„
            const { targetId, amount } = event.payload;
            const target = core.players[targetId];
            if (!target) return core;
            return {
                ...core,
                players: {
                    ...core.players,
                    [targetId]: { ...target, hp: Math.max(0, target.hp - amount) },
                },
            };
        }
        // æ¯ç§äº‹ä»¶ç±»å‹ä¸€ä¸ª case
        default: return core;
    }
}
```

**å…³é”®çº¦æŸ**ï¼š
- reduce å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œä¸ä¾èµ–éšæœºæ•°ã€‚
- **ç¦æ­¢ `JSON.parse(JSON.stringify())`**ï¼ˆæ€§èƒ½ç¾éš¾ï¼‰ã€‚åª spread å˜æ›´è·¯å¾„ï¼Œæœªå˜è·¯å¾„ä¿æŒåŸå¼•ç”¨ã€‚
- åµŒå¥—è¶…è¿‡ 3 å±‚æ—¶æå– `updatePlayer()` ç­‰ helper åˆ° `domain/utils.ts`ã€‚
- è¯¦è§ `docs/ai-rules/engine-systems.md`ã€ŒReducer ç»“æ„å…±äº«èŒƒä¾‹ã€ã€‚

### 3.4 å®ç° isGameOver

```ts
isGameOver: (core): GameOverResult | undefined => {
    // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
    // è¿”å› { winner: playerId } æˆ– { draw: true } æˆ– undefined
}
```

### 3.5 è¡¥å……å•å…ƒæµ‹è¯•

åœ¨ `__tests__/` åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼Œè¦†ç›–ï¼š
- æ­£å¸¸æµç¨‹ï¼ˆhappy pathï¼‰
- éæ³•æ“ä½œè¢«æ‹’ç»
- è¾¹ç•Œæ¡ä»¶
- èƒœåˆ©æ¡ä»¶åˆ¤å®š

**æµ‹è¯•è¾…åŠ©æ¨¡å¼**ï¼ˆå‚è€ƒ smashup/__tests__/helpers.tsï¼‰ï¼š
```ts
export function makePlayer(id: string, overrides?: Partial<PlayerState>): PlayerState { ... }
export function makeState(overrides?: Partial<Core>): Core { ... }
export function makeMatchState(core: Core): MatchState<Core> { ... }
```

### éªŒæ”¶

```bash
npx vitest run src/games/<gameId>  # æ‰€æœ‰æµ‹è¯•é€šè¿‡
```

æ ¸å¿ƒè§„åˆ™æ­£å¸¸ + å¼‚å¸¸åœºæ™¯æœ‰è¦†ç›–ã€‚

---

## é˜¶æ®µ 4ï¼šFlowSystem ä¸ç³»ç»Ÿç»„è£…

**ç›®æ ‡**ï¼šæ¥å…¥ FlowSystem å®Œæˆé˜¶æ®µæµè½¬ï¼Œ`game.ts` ç»„è£…å®Œæ¯•ã€‚

### 4.1 å®ç° FlowHooks

åˆ›å»º `domain/flowHooks.ts`ï¼ˆå‚è€ƒ summonerwars/domain/flowHooks.tsï¼‰ï¼š

```ts
import type { FlowHooks, PhaseExitResult } from '../../../engine/systems/FlowSystem';

export const flowHooks: FlowHooks<Core> = {
    // åˆå§‹é˜¶æ®µï¼ˆé€šå¸¸ä¸º factionSelect æˆ–ç¬¬ä¸€ä¸ªæ¸¸æˆé˜¶æ®µï¼‰
    initialPhase: 'factionSelect',

    // æ˜¯å¦å…è®¸æ¨è¿›
    canAdvance: ({ state }) => ({ ok: true }),

    // ä¸‹ä¸€é˜¶æ®µè®¡ç®—
    getNextPhase: ({ state, from }) => {
        const idx = PHASE_ORDER.indexOf(from as GamePhase);
        return PHASE_ORDER[(idx + 1) % PHASE_ORDER.length];
    },

    // å½“å‰æ´»è·ƒç©å®¶
    getActivePlayerId: ({ state }) => state.core.currentPlayer,

    // é˜¶æ®µé€€å‡ºå‰¯ä½œç”¨ï¼ˆå¦‚ï¼šæŠ½ç‰Œ/åˆ‡æ¢å›åˆ/ç»“ç®—ä¼¤å®³ï¼‰
    onPhaseExit: ({ state, from }): PhaseExitResult => {
        const events: GameEvent[] = [];
        // æŒ‰é˜¶æ®µå¤„ç†å‰¯ä½œç”¨
        return { events };
    },

    // é˜¶æ®µè¿›å…¥å‰¯ä½œç”¨ï¼ˆå¦‚ï¼šå›åˆå¼€å§‹äº‹ä»¶/çŠ¶æ€é‡ç½®ï¼‰
    onPhaseEnter: ({ state, from, to }): GameEvent[] => {
        const events: GameEvent[] = [];
        // æŒ‰é˜¶æ®µå¤„ç†å‰¯ä½œç”¨
        return events;
    },

    // è‡ªåŠ¨æ¨è¿›æ£€æŸ¥ï¼ˆå¦‚ï¼šéäº¤äº’é˜¶æ®µè‡ªåŠ¨è·³è¿‡ï¼‰
    onAutoContinueCheck: ({ state, events }) => {
        // å¦‚ startTurn/endTurn ç­‰çº¯è‡ªåŠ¨é˜¶æ®µ
        return undefined;
    },
};
```

**ä¸‰ä¸ªæ¸¸æˆçš„ FlowHooks å¤æ‚åº¦å¯¹æ¯”**ï¼š
- smashup: `domain/index.ts` å†…è”ï¼ˆ~150 è¡Œï¼‰ï¼Œé˜¶æ®µé€€å‡ºå¤„ç†è®°åˆ†é€»è¾‘
- summonerwars: ç‹¬ç«‹ `domain/flowHooks.ts`ï¼ˆ~250 è¡Œï¼‰ï¼Œé˜¶æ®µè¿›é€€å¤„ç†æŠ½ç‰Œ/æ¢äºº/æŠ€èƒ½è§¦å‘
- dicethrone: `game.ts` å†…è”ï¼ˆ~500 è¡Œï¼‰ï¼Œæœ€å¤æ‚ï¼Œæ”»é˜²é˜¶æ®µæœ‰å¤§é‡åˆ†æ”¯

### 4.2 å®Œå–„ game.ts

```ts
// ç³»ç»Ÿé€‰æ‹©æ¨¡å¼ï¼ˆä¸‰ä¸ªæ¸¸æˆå…±åŒæ¨¡å¼ï¼‰
const systems = [
    createFlowSystem<Core>({ hooks: flowHooks }),
    // æ–¹å¼ Aï¼šé€ä¸ªé€‰æ‹©ï¼ˆdicethrone/summonerwars é£æ ¼ï¼Œç²¾ç»†æ§åˆ¶ï¼‰
    createEventStreamSystem(),
    createLogSystem(),
    createActionLogSystem({ commandAllowlist: ACTION_ALLOWLIST, formatEntry }),
    createUndoSystem({ snapshotCommandAllowlist: ACTION_ALLOWLIST }),
    createInteractionSystem(),
    createRematchSystem(),
    createResponseWindowSystem({  // éœ€è¦å“åº”çª—å£æ—¶é…ç½®æ³¨å…¥
        allowedCommands: ['PLAY_CARD'],  // å“åº”æœŸé—´å…è®¸çš„æ¸¸æˆå‘½ä»¤
        responseAdvanceEvents: [         // è§¦å‘å“åº”è€…æ¨è¿›çš„äº‹ä»¶
            { eventType: 'CARD_PLAYED' },
        ],
        // interactionLock: { ... },     // å¤šæ­¥äº¤äº’é”å®šï¼ˆå¯é€‰ï¼‰
    }),
    createTutorialSystem(),
    createCheatSystem<Core>(cheatModifier),

    // æ–¹å¼ Bï¼šé»˜è®¤é›†åˆï¼ˆsmashup é£æ ¼ï¼Œç®€æ´ï¼‰
    // ...createBaseSystems<Core>(),
    // createCheatSystem<Core>(cheatModifier),
];

// å‘½ä»¤ç±»å‹ï¼ˆåªåˆ—ä¸šåŠ¡å‘½ä»¤ï¼Œç³»ç»Ÿå‘½ä»¤ç”± adapter è‡ªåŠ¨åˆå¹¶ï¼‰
const commandTypes = [
    ...Object.values(XX_COMMANDS),
];
```

### 4.3 å®ç° CheatModifierï¼ˆå¼€å‘è°ƒè¯•å¿…å¤‡ï¼‰

å‚è€ƒ summonerwars/game.ts çš„ `summonerWarsCheatModifier`ï¼Œè‡³å°‘å®ç°ï¼š
- `getResource` / `setResource`
- `setPhase`
- `dealCardByIndex`ï¼ˆå¦‚æœ‰ç‰Œåº“ï¼‰

### 4.4 ActionLog + å¡ç‰Œé¢„è§ˆï¼ˆé¿å…é‡å¤è¯´æ˜ï¼ŒæŒ‰æƒå¨å®ç°åšï¼‰

**å¼ºåˆ¶å…ˆè¯»ï¼ˆæƒå¨å•ä¸€æ¥æºï¼‰**ï¼š
- `docs/ai-rules/engine-systems.md`ï¼ˆActionLogSystem ä½¿ç”¨è§„èŒƒï¼‰
- `evidence/action-log-card-preview.md`ï¼ˆå¡ç‰Œé¢„è§ˆæ³¨å†Œè¡¨æ¨¡å¼ + æ•°æ®æµè¯´æ˜ï¼‰

**ä½ åœ¨æ–°æ¸¸æˆé‡Œåªéœ€è¦åšè¿™äº›ï¼ˆæœ€å°é—­ç¯ï¼‰**ï¼š
1. åœ¨ `game.ts` é…ç½® `createActionLogSystem({ commandAllowlist, formatEntry })`ï¼Œ`formatEntry` äº§å‡ºåŒ…å« `segments` çš„ `ActionLogEntry`ã€‚
2. è‹¥æ¸¸æˆæœ‰å¡ç‰Œï¼šå®ç° `ui/cardPreviewHelper.ts` æä¾› `cardId â†’ CardPreviewRef` æŸ¥è¯¢ï¼Œå¹¶åœ¨ `game.ts` **æ–‡ä»¶æœ«å°¾**è°ƒç”¨ `registerCardPreviewGetter(gameId, getter)` æ³¨å†Œã€‚

> å…³é”®ç‚¹ï¼šVite SSR çš„å‡½æ•°æå‡é™·é˜±ä¸â€œæ³¨å†Œå¿…é¡»æ”¾æ–‡ä»¶æœ«å°¾â€çš„åŸå› ï¼Œè¯¦è§ `AGENTS.md` / `docs/ai-rules/golden-rules.md`ã€‚

### 4.5 è¡¥å…… FlowHooks æµ‹è¯•

```bash
npx vitest run src/games/<gameId>/__tests__/flow.test.ts
```

### éªŒæ”¶

```bash
npm run generate:manifests   # æ¸…å•ç”ŸæˆæˆåŠŸ
npx vitest run src/games/<gameId>  # æ‰€æœ‰æµ‹è¯•é€šè¿‡
npm run dev                  # æ¸¸æˆå¯ä»å¤§å…åˆ›å»ºå¯¹å±€ï¼ŒåŸºç¡€å›åˆå¯æ¨è¿›
```

---

## é˜¶æ®µ 5ï¼šBoard/UI ä¸äº¤äº’é—­ç¯

**ç›®æ ‡**ï¼šæä¾›æœ€å°å¯ç© UIï¼Œå®Œæˆäº¤äº’é—­ç¯ã€‚

### 5.0 UI è®¾è®¡è§„èŒƒç”Ÿæˆï¼ˆå¼ºåˆ¶å‰ç½®ï¼‰

**å¼ºåˆ¶å…ˆè¯»ï¼ˆæƒå¨å•ä¸€æ¥æºï¼‰**ï¼š
- `docs/ai-rules/ui-ux.md`
- è‹¥æ¶‰åŠåŠ¨ç”»/ç‰¹æ•ˆï¼š`docs/ai-rules/animation-effects.md`
- è‹¥å‡ºç°ç™½å±/æ¸²æŸ“é”™è¯¯/å‡½æ•°æœªå®šä¹‰ï¼š`docs/ai-rules/golden-rules.md`

> æ¯ä¸ªæ¸¸æˆçš„è§†è§‰é£æ ¼å„ä¸ç›¸åŒï¼Œ**ç¦æ­¢ç›´æ¥å¤ç”¨å·²æœ‰æ¸¸æˆçš„æ ·å¼è§„èŒƒ**ã€‚å¿…é¡»ä¸ºæ–°æ¸¸æˆç”Ÿæˆç‹¬ç«‹çš„è®¾è®¡è§„èŒƒã€‚

1. **æ‰§è¡Œ ui-ux-pro-max `--design-system`**ï¼šæ ¹æ®æ–°æ¸¸æˆçš„ç±»å‹ã€é¢˜æã€ç¾æœ¯é£æ ¼ç”Ÿæˆä¸“å±è®¾è®¡ç³»ç»Ÿï¼š
   ```bash
   python3 skills/ui-ux-pro-max/scripts/search.py "<æ¸¸æˆç±»å‹> <é¢˜æ> <é£æ ¼å…³é”®è¯>" --design-system --persist -p "<æ¸¸æˆå>" --page "game-board"
   ```
2. **äº§å‡ºä¿å­˜åˆ° `design-system/games/<gameId>.md`**ï¼šä½œä¸ºè¯¥æ¸¸æˆçš„ UI æƒå¨å‚è€ƒï¼Œåç»­ Board/ç»„ä»¶å¼€å‘ä»¥æ­¤ä¸ºå‡†ã€‚
3. **ä¸é€šç”¨è§„èŒƒçš„å…³ç³»**ï¼š`design-system/game-ui/MASTER.md` ä¸­çš„äº¤äº’åŸåˆ™ï¼ˆåé¦ˆ/çŠ¶æ€æ¸…æ™°/åŠ¨ç”»æ—¶é•¿ç­‰ï¼‰ä»ç„¶é€‚ç”¨ï¼Œä½†é…è‰²/å­—ä½“/è§†è§‰é£æ ¼ä»¥æ¸¸æˆä¸“å±è§„èŒƒä¸ºå‡†ã€‚

### 5.1 Board.tsx ä¸»ç»„ä»¶

**ä¸‰ä¸ªæ¸¸æˆçš„ Board å…±åŒæ¨¡å¼**ï¼š

```tsx
const Board: React.FC<Props> = ({ G, moves, playerID, ctx }) => {
    const core = G.core;
    const phase = G.sys.phase;
    const gameMode = useGameMode();
    const { t } = useTranslation('game-<gameId>');

    // 1. åŸºç¡€çŠ¶æ€
    const isGameOver = ctx.gameover;
    const isMyTurn = playerID === core.currentPlayer;

    // 2. æ•™å­¦ç³»ç»Ÿé›†æˆ
    useTutorialBridge(G.sys.tutorial, moves as Record<string, unknown>);
    const { isActive: isTutorialActive, currentStep: tutorialStep } = useTutorial();

    // 3. éŸ³æ•ˆç³»ç»Ÿ
    useGameAudio({ config: AUDIO_CONFIG, gameId: MANIFEST.id, G: core, ctx: { ... } });

    // 4. äº‹ä»¶æ¶ˆè´¹ â†’ åŠ¨ç”»é©±åŠ¨
    const gameEvents = useGameEvents({ G, myPlayerId: playerID || '0' });

    // 5. é˜µè¥/è§’è‰²é€‰æ‹©é˜¶æ®µ
    if (isInSelectionPhase) {
        return <FactionSelection ... />;
    }

    // 6. æ¸¸æˆä¸» UI
    return (
        <div className="...">
            {/* æ£‹ç›˜/åŸºåœ°/å¡ç‰ŒåŒºåŸŸ */}
            {/* æ‰‹ç‰ŒåŒº */}
            {/* é˜¶æ®µæŒ‡ç¤º/æ“ä½œæŒ‰é’® */}
            {/* ç»“ç®—è¦†ç›–å±‚ */}
            {isGameOver && <EndgameOverlay ... />}
        </div>
    );
};
```

### 5.2 UI å­æ¨¡å—æ‹†åˆ†

å½“ Board.tsx è¶…è¿‡ 300 è¡Œæ—¶ï¼ŒæŒ‰èŒè´£æ‹†åˆ†åˆ° `ui/` ç›®å½•ï¼š

**å‚è€ƒ summonerwars/ui/**ï¼š
- `BoardGrid.tsx` â€” æ£‹ç›˜ç½‘æ ¼æ¸²æŸ“
- `HandArea.tsx` â€” æ‰‹ç‰ŒåŒº
- `PhaseTracker.tsx` â€” é˜¶æ®µæŒ‡ç¤ºå™¨
- `PlayerInfo.tsx` â€” ç©å®¶ä¿¡æ¯é¢æ¿
- `GameButton.tsx` â€” æ¸¸æˆæ“ä½œæŒ‰é’®
- `useGameEvents.ts` â€” äº‹ä»¶æ¶ˆè´¹ hook
- `useCellInteraction.ts` â€” æ ¼å­äº¤äº’ hook
- `BoardEffects.tsx` â€” ç‰¹æ•ˆå±‚
- `FactionSelection.tsx` â€” é˜µè¥é€‰æ‹© UI

**å‚è€ƒ smashup/ui/**ï¼š
- `HandArea.tsx` â€” æ‰‹ç‰ŒåŒº
- `FactionSelection.tsx` â€” æ´¾ç³»é€‰æ‹©
- `PromptOverlay.tsx` â€” æç¤ºè¦†ç›–å±‚
- `useGameEvents.ts` â€” äº‹ä»¶æ¶ˆè´¹
- `BoardEffects.tsx` â€” ç‰¹æ•ˆå±‚

### 5.3 äº¤äº’æ˜ å°„

æ‰€æœ‰ç”¨æˆ·æ“ä½œé€šè¿‡ `moves[COMMAND_TYPE](payload)` è§¦å‘ï¼š
- ç‚¹å‡»/æ‹–æ‹½ â†’ Command
- Board ä¸ç›´æ¥æ”¹ core

### 5.4 é˜µè¥/è§’è‰²é€‰æ‹©

**ä¸‰ä¸ªæ¸¸æˆå…±åŒæ¨¡å¼**ï¼šåˆå§‹é˜¶æ®µæ˜¯ `factionSelect`/`setup`ï¼Œé€šè¿‡ FlowHooks çš„ `onAutoContinueCheck` åœ¨æ‰€æœ‰ç©å®¶å‡†å¤‡åè‡ªåŠ¨æ¨è¿›åˆ°æ¸¸æˆé˜¶æ®µã€‚

UI ä¾§ä½¿ç”¨ `TutorialSelectionGate`ï¼ˆæ¡†æ¶ç»„ä»¶ï¼‰æˆ–è‡ªå®šä¹‰é€‰æ‹©ç»„ä»¶ã€‚

### éªŒæ”¶

- æ ¸å¿ƒæ“ä½œå¯åœ¨ UI ä¸­å®Œæˆ
- é˜¶æ®µæ¨è¿›æ­£å¸¸
- ç»“æŸç•Œé¢æ­£å¸¸æ˜¾ç¤º

---

## é˜¶æ®µ 6ï¼šæ”¶å°¾ä¸å¯ç”¨

**ç›®æ ‡**ï¼šè¡¥é½ i18nã€æµ‹è¯•ã€æ•™å­¦ã€éŸ³æ•ˆã€‚

### 6.1 i18n æ–‡æ¡ˆ

è¡¥é½ `public/locales/{zh-CN,en}/game-<gameId>.json` ä¸­çš„æ‰€æœ‰æ–‡æ¡ˆï¼š
- é˜¶æ®µåç§°
- å‘½ä»¤/äº‹ä»¶æè¿°
- UI æ–‡æœ¬
- æ•™å­¦æ­¥éª¤æ–‡æ¡ˆ

### 6.2 æ•™å­¦é…ç½®

å‚è€ƒ smashup/tutorial.ts çš„æ¨¡å¼ï¼š
1. setup æ­¥éª¤ï¼šAI è‡ªåŠ¨å®Œæˆé€‰è§’ + ä½œå¼Šè®¾ç½®æ‰‹ç‰Œ
2. UI ä»‹ç»æ­¥éª¤ï¼šé€ä¸ªé«˜äº® UI å…ƒç´ ï¼ˆ`highlightTarget` + `blockedCommands`ï¼‰
3. æ“ä½œæ•™å­¦æ­¥éª¤ï¼š`requireAction: true` + `allowedCommands` + `advanceOnEvents`

### 6.3 éŸ³é¢‘é…ç½®ï¼ˆå·²é‡æ„ï¼Œé¿å…é‡å¤é€ è½®å­ï¼‰

**å¼ºåˆ¶å…ˆè¯»**ï¼ˆæƒå¨å•ä¸€æ¥æºï¼Œé¿å…æœ¬æ–‡æ¡£è¿‡æ—¶ï¼‰ï¼š
- `AGENTS.md`ã€ŒéŸ³é¢‘èµ„æºæ¶æ„ï¼ˆå¼ºåˆ¶ï¼‰ã€
- `docs/ai-rules/asset-pipeline.md`ã€ŒğŸ”Š éŸ³é¢‘èµ„æºè§„èŒƒã€
- `docs/audio/audio-usage.md`ï¼ˆæ–°å¢éŸ³é¢‘èµ„äº§æµç¨‹è§ `docs/audio/add-audio.md`ï¼‰

**ä½ åœ¨æ–°æ¸¸æˆé‡Œåªéœ€è¦åšè¿™äº›ï¼ˆæœ€å°é—­ç¯ï¼‰**ï¼š
1. åˆ›å»º `src/games/<gameId>/audio.config.ts`ï¼Œå¯¼å‡º `GameAudioConfig`ï¼š
   - `feedbackResolver(event): SoundKey | null`ï¼šæ— åŠ¨ç”»äº‹ä»¶è¿”å› SoundKeyï¼›æœ‰åŠ¨ç”»äº‹ä»¶è¿”å› `null`ï¼ŒéŸ³æ•ˆäº¤ç»™åŠ¨ç”»å±‚ `onImpact()` æ’­æ”¾
   - `criticalSounds`ï¼šè¿›å…¥æ¸¸æˆåç«‹å³é¢„åŠ è½½çš„é«˜é¢‘éŸ³æ•ˆ keyï¼ˆå»ºè®® 5~15ï¼‰
   - ï¼ˆå¯é€‰ï¼‰`contextualPreloadKeys`ï¼šæ ¹æ®ä¸Šä¸‹æ–‡å¢é‡é¢„çƒ­
   - BGM åˆ—è¡¨æŒ‰ç°æœ‰æ¸¸æˆæ ¼å¼é…ç½®ï¼ˆå…·ä½“è§„åˆ™ä»¥ `docs/audio/audio-usage.md` ä¸ºå‡†ï¼‰
2. **éŸ³æ•ˆ key çš„å”¯ä¸€æ¥æº**ï¼š`public/assets/common/audio/registry.json`ã€‚
   - ç¦æ­¢åœ¨æ¸¸æˆå±‚å£°æ˜ `basePath/sounds`
   - ç¦æ­¢æ‰‹å†™ `compressed/`
   - ç¦æ­¢å®šä¹‰çŸ­ keyï¼ˆå¦‚ `click/dice_roll`ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ registry çš„å®Œæ•´ key
3. **é¿å…é‡å¤æ’­æ”¾**ï¼šåŒä¸€åŠ¨ä½œåªèƒ½èµ°ä¸€æ¡è·¯å¾„ï¼ˆ`feedbackResolver` / FX `FeedbackPack` / åŠ¨ç”» `onImpact` / UI `GameButton` / `playDeniedSound()`ï¼‰ã€‚

> å‚è€ƒå®ç°ï¼š`src/games/smashup/audio.config.ts` / `src/games/summonerwars/audio.config.ts`ã€‚

### 6.4 å…³é”®å›¾ç‰‡é¢„åŠ è½½ï¼ˆè‹¥æ¸¸æˆæœ‰ç²¾çµå›¾/å›¾é›†ï¼‰

**å¼ºåˆ¶å…ˆè¯»ï¼ˆæƒå¨å•ä¸€æ¥æºï¼‰**ï¼š
- `docs/ai-rules/asset-pipeline.md`ï¼ˆcritical/warm è§„åˆ™ã€è·¯å¾„æ ¼å¼ã€é—¨ç¦ä¸éªŒæ”¶æ¸…å•ï¼‰

**ä½ åœ¨æ–°æ¸¸æˆé‡Œåªéœ€è¦åšè¿™äº›ï¼ˆæœ€å°é—­ç¯ï¼‰**ï¼š
1. å®ç° `criticalImageResolver.ts`ï¼Œè¿”å› `{ critical, warm }`ï¼Œå¹¶æŒ‰â€œé€‰æ‹©é˜¶æ®µ vs æ¸¸æˆé˜¶æ®µâ€åŠ¨æ€è§£æã€‚
2. åœ¨ `game.ts`ï¼ˆæˆ–æ¸¸æˆå…¥å£çº¦å®šçš„ä½ç½®ï¼‰æ³¨å†Œ resolverã€‚

> å‚è€ƒå®ç°ï¼š`src/games/smashup/criticalImageResolver.ts` / `src/games/summonerwars/criticalImageResolver.ts` / `src/games/dicethrone/criticalImageResolver.ts`ã€‚

### 6.5 debug-configï¼ˆå¯é€‰ï¼‰

è‹¥éœ€è¦è°ƒè¯•é¢æ¿ï¼Œåˆ›å»º `debug-config.tsx` æä¾›æ¸¸æˆä¸“å±è°ƒè¯•é€‰é¡¹ã€‚

**è°ƒè¯•é¢æ¿è§„èŒƒ**ï¼š
- è°ƒè¯•å…¥å£ç»Ÿä¸€ä½¿ç”¨ `GameDebugPanel` ç»„ä»¶æŒ‚è½½åœ¨ Board å†…ï¼Œä¸å¾—åˆ›å»ºæ–°çš„å…¨å±€å…¥å£ã€‚
- è°ƒè¯•æ“ä½œå¿…é¡»é€šè¿‡ `SYS_CHEAT_*` æŒ‡ä»¤ï¼ˆä¾èµ– CheatSystemï¼‰ï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹ coreã€‚
- è‹¥åŒ…å«â€œå‘ç‰Œ/å‡ºç‰Œâ€ç±»è°ƒè¯•ï¼š
  - **å¿…é¡»ä»¥ç²¾çµå›¾ç´¢å¼•ä¸ºå‘ç‰Œä¾æ®**ï¼ˆæˆ–ç­‰ä»·çš„ç¨³å®šç´¢å¼•ï¼‰ï¼Œä¿è¯å¯å¤ç°ã€‚
  - **å¿…é¡»æä¾›ç´¢å¼•å¯¹ç…§è¡¨**ï¼ˆç´¢å¼• â†’ åç§°/ç±»å‹ï¼‰ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ä¸ä¸€é”®å‘ç‰Œã€‚
- é¢æ¿å†…çŠ¶æ€å¤åˆ¶/èµ‹å€¼éœ€æ ¡éªŒ JSONï¼Œå¤±è´¥ç»™å‡ºæ˜ç¡®æç¤ºã€‚
- é‡è¦è°ƒè¯•åŠ¨ä½œå°½é‡æä¾›å¿«æ·æŒ‰é’®ï¼ˆå¦‚â€œæ¸…é›¶/æ»¡å€¼/åˆ‡æ¢é˜¶æ®µâ€ï¼‰ã€‚

### 6.6 ç¼©ç•¥å›¾

1. ç”¨æˆ·æä¾›å›¾ç‰‡åæ”¾å…¥ `public/assets/<gameId>/thumbnails/`
2. è¿è¡Œ `npm run compress:images -- public/assets/<gameId>/thumbnails`
3. `manifest.ts` ä¸­ `thumbnailPath` å·²é…ç½®

### 6.7 æœ€ç»ˆéªŒè¯

```bash
npm run generate:manifests          # æ¸…å•ç”ŸæˆæˆåŠŸ
npx vitest run src/games/<gameId>   # æ‰€æœ‰æµ‹è¯•é€šè¿‡
npm run dev                         # å¤§å…å¯è§ã€å¯åˆ›å»ºå¯¹å±€ã€å¯å®Œæ•´æ¸¸ç©
```

### éªŒæ”¶

- æ¸…å•ç”ŸæˆæˆåŠŸ
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- æ¸¸æˆå¯ä»å¤§å…è¿›å…¥å¹¶å®Œæˆå®Œæ•´æ¸¸ç©æµç¨‹
- i18n åŒè¯­é½å…¨

---

## ç³»ç»Ÿä¸çº¢çº¿é€ŸæŸ¥ï¼ˆåªä¿ç•™æœ¬ skill çš„æœ€å°æé†’ï¼‰

**æƒå¨æ¥æº**ï¼šç³»ç»Ÿæ¸…å•/çº¢çº¿/åæ¨¡å¼ä»¥ `AGENTS.md` + `docs/ai-rules/engine-systems.md` ä¸ºå‡†ï¼Œæœ¬èŠ‚ä¸å†é‡å¤æŠ„å†™ã€‚

### ç³»ç»Ÿç»„è£…æœ€å°æé†’

- `createBaseSystems()` é»˜è®¤åŒ…å«ï¼šEventStream + Log + ActionLog + Undo + Interaction + Rematch + ResponseWindow + Tutorial
- `createBaseSystems()` **ä¸åŒ…å«** FlowSystem / CheatSystemï¼šéœ€è¦è‡ªè¡Œè¿½åŠ 
- `commandTypes` **åªåˆ—ä¸šåŠ¡å‘½ä»¤**ï¼šç³»ç»Ÿå‘½ä»¤ç”± adapter è‡ªåŠ¨åˆå¹¶
- ResponseWindowSystem **å¿…é¡»é…ç½®æ³¨å…¥**ï¼š`allowedCommands` / `responseAdvanceEvents`ï¼ˆç¦æ­¢æ”¹å¼•æ“æ–‡ä»¶ï¼‰

### æ–°æ¶æ„å¼ºåˆ¶å¤ç”¨ï¼ˆæ–°æ¸¸æˆï¼‰

- èƒ½åŠ›ç³»ç»Ÿï¼šå¿…é¡»ä½¿ç”¨ `engine/primitives/ability.ts`
- çŠ¶æ€/buff/debuffï¼šå¿…é¡»ä½¿ç”¨ `engine/primitives/tags.ts`
- æ•°å€¼ä¿®æ”¹ï¼šå¿…é¡»ä½¿ç”¨ `engine/primitives/modifier.ts`
- å¯è¢« buff ä¿®æ”¹çš„å±æ€§ï¼šå¿…é¡»ä½¿ç”¨ `engine/primitives/attribute.ts`ï¼ˆçº¯èµ„æºæ¶ˆè€—ä»ç”¨ `resources.ts`ï¼‰

---

## å‚è€ƒèµ„æ–™

- ç›®å½•éª¨æ¶ä¸æœ€å°æ¨¡æ¿ï¼šreferences/game-skeleton.md
- æ¸…å•ç”Ÿæˆè¯´æ˜ï¼šreferences/manifest-generation.md
- é¡¹ç›®ç»“æ„é€Ÿè§ˆï¼šreferences/project-structure.md

## æ¶æ„å‚è€ƒè·¯å¾„ï¼ˆä»…ç”¨äºç†è§£ï¼Œä¸ç…§æŠ„ï¼‰

- **æœ€å¤æ‚æµç¨‹**ï¼š`src/games/dicethrone/`ï¼ˆè§’è‰²ç³»ç»Ÿ/éª°å­/æ”»é˜²/çŠ¶æ€æ•ˆæœ/Tokenå“åº”ï¼‰
- **ä¸­ç­‰å¤æ‚ + æ£‹ç›˜æˆ˜æ£‹**ï¼š`src/games/summonerwars/`ï¼ˆç½‘æ ¼æ£‹ç›˜/å•ä½ç®¡ç†/é˜µè¥ç‰Œç»„/æŠ€èƒ½ç³»ç»Ÿï¼‰
- **ä¸­ç­‰å¤æ‚ + å¡ç‰ŒåŒºæ§**ï¼š`src/games/smashup/`ï¼ˆå¤šäººæ”¯æŒ/åŸºåœ°è®°åˆ†/æ´¾ç³»æ··æ­/æŒç»­æ•ˆæœï¼‰
- **æ¡†æ¶å±‚ç»„ä»¶**ï¼š`src/components/game/framework/`
- **å¼•æ“ç³»ç»Ÿ**ï¼š`src/engine/systems/`
- **å¼•æ“åŸè¯­**ï¼š`src/engine/primitives/`

## ç¼©ç•¥å›¾é…ç½®æ¨¡æ¿ï¼ˆthumbnail.tsxï¼‰

```tsx
import manifest from './manifest';
import { ManifestGameThumbnail } from '../../components/lobby/thumbnails';

export default function Thumbnail() {
    return <ManifestGameThumbnail manifest={manifest} />;
}
```

- `manifest.ts` ä¸­é…ç½® `thumbnailPath: '<gameId>/thumbnails/cover'`ï¼ˆä¸å«æ‰©å±•åã€ä¸å« `compressed/`ï¼‰ã€‚
- ç”¨æˆ·æä¾›å›¾ç‰‡åï¼Œè¿è¡Œ `npm run compress:images -- public/assets/<gameId>/thumbnails` å‹ç¼©ã€‚
