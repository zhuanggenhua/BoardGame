# 斗地主需求记录（用于通用引擎扩展，不做游戏特化）

> 说明：此文档记录用户需求与通用能力缺口。实现时**不得**对斗地主进行特殊处理，必须以“可复用能力”为目标。

## 目标
- 基于 UGC Builder + 预览/运行层，实现“用户输入需求 → 自动生成配置/代码 → 可运行”的端到端流程。
- 需求本身可包含具体游戏规则，但引擎能力必须通用化。

## 主线裁决（当前执行路线）
- 引擎定位：仅支持“需求 → 提示词 → 外部 AI → 粘贴导入”，不提供手动代码编辑或结构化效果块。
- 当前主线：基于 DomainCore 规则代码执行，并补齐“规则执行框架 + 通用组件能力”（不包含任何游戏规则）作为系统层能力。
- ugc-builder-v2 的分层模块化与“结构化效果块/移除 code”方向暂不作为主线；若后续推进需单独迁移方案避免与现有运行时分叉。

## 需求清单（按输入位置）

### 规则填写（规则面板）
1. 我要制作一款斗地主游戏。
2. 开始时每人发 17 张牌。
3. 打出所有手牌即可获胜（阵营胜负：出完手牌的一方阵营获胜）。
4. 玩家数据不作为模板，按规则自动生成。
5. 首家：暂定房主为第一手。

### 手牌区（布局代码）
- 需求：顺序排开。

### 手牌区（选中效果）
- 需求：抬高。

### 手牌区（排序）
- 需求：按斗地主规则排序（包含大小王）。

### 手牌区（操作按钮/钩子）
- 仅对当前玩家有效。
- 开局显示“抢地主”“叫分”按钮。
- 允许“跳过不出”。
- 出牌规则：可打出斗地主牌型，且必须比上一家大（规则运行层负责校验）。

### 玩家信息
- 显示玩家名称。

### 其他玩家手牌区
- 复制玩家手牌区配置。
- 但需要支持“背面渲染”。

### 出牌区
- 需求：添加“无法使用钩子”的约束（理解为：出牌区禁用出牌规则钩子，仅允许布局/展示）。

### 数据库 AI 生成
- 需求：生成完整 54 张扑克牌（包含大小王）数据。
- 建议字段：花色/点数/显示文本/排序键（不做游戏特化）。

### 预览层
- 预览必须重构，以真实运行环境为设计依据。
- 考虑内联窗口形态。

### 玩家人数
- 玩家人数由“玩家信息组件数量 + 1（自己可无玩家信息组件）”推导。

## 需要扩展的通用能力（非游戏特化）
1. **需求保存**：UGC 状态应存储 requirements，并支持导入/导出。
2. **预览对齐运行**：预览层需与运行层能力一致（避免“预览限制发挥”）。
3. **手牌区动作钩子**：提供“操作按钮/动作钩子”机制，并支持“仅当前玩家启用”。
4. **出牌区钩子禁用**：提供开关禁用规则钩子（例如仅展示布局）。
5. **背面渲染策略**：区域级别可强制使用背面渲染（不依赖具体游戏）。
6. **玩家数量推导**：基于玩家信息组件数量推导玩家数（+1 自己）。
7. **AI 数据生成**：支持“根据需求生成完整牌库数据”的通用能力。
8. **通用规则执行框架**：提供规则执行管线、基础组件与动作钩子能力，但不内置任何游戏规则/牌型/比较逻辑。

## 约束
- 禁止在提示词模板或引擎层硬编码具体游戏规则或牌型。
- 所有新增能力必须可被其他游戏复用。

## 备注
- 需求若存在小问题，允许在实现时自优化（无需反复确认）。
