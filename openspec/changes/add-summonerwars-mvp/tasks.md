## 1. 通用布局标注工具（框架层）
- [x] 1.1 定义类型契约 `/core/ui/board-layout.types.ts`：BoardLayoutConfig、GridConfig、ZoneConfig、TrackConfig、StackPointConfig，坐标归一化 0-1
- [x] 1.2 实现通用编辑器 `/components/game/framework/BoardLayoutEditor.tsx`：
  - 图片背景加载与拖拽预览
  - 网格校准器（行列数 + 偏移 + 间距gap）
  - 区域标记器（框选矩形）
  - 轨道标注器（依次点击生成点位）
  - 堆叠点标注器（位置 + 叠层方向）
  - 导出/导入 JSON
- [x] 1.3 实现通用渲染器 `/components/game/framework/BoardLayoutRenderer.tsx`：根据配置渲染网格/区域/轨道高亮/堆叠卡牌，坐标映射适配容器尺寸
- [x] 1.4 实现命中检测 `/core/ui/board-hit-test.ts`：像素→格子/区域/轨道映射，支持滚动偏移

## 2. SummonerWars 领域内核
- [x] 2.1 定义核心类型：战场网格、玩家、卡牌、阶段、资源/魔力轨道
- [x] 2.2 设计命令/事件集合与校验（召唤/移动/建造/攻击/弃牌换魔力/抽牌/阶段推进）
- [x] 2.3 实现 Reducer/Execute：阶段顺序、规则约束、胜负判定
- [x] 2.4 接入 FlowSystem（阶段门禁 + 自动推进策略）
  - 已完成：创建 flowHooks.ts 定义阶段流转规则
  - 阶段退出副作用：攻击阶段不活动惩罚、抽牌阶段自动抽牌
  - 阶段进入副作用：抽牌→召唤时触发回合切换
  - Board.tsx 使用 FLOW_COMMANDS.ADVANCE_PHASE 替代 SW_COMMANDS.END_PHASE
- [x] 2.5 实现骰子攻击解析与伤害/摧毁/奖励规则
- [x] 2.6 实现魔力轨道与弃牌换魔力逻辑（0-15 范围限制）
- [x] 2.7 实现抽牌阶段逻辑（抽至 5、牌堆空不洗）
- [x] 2.8 实现手牌系统：初始发牌、抽牌、弃牌、手牌显示
- [x] 2.9 实现召唤单位命令：从手牌召唤、扣除魔力、放置到城门相邻
- [x] 2.10 实现示例牌组数据：亡灵法师派系基础卡牌

## 3. SummonerWars UI 与集成
- [x] 3.1 构建大地图滚动视口（仅垂直滚动）与坐标映射渲染
- [x] 3.2 Board 内通过 GameDebugPanel 挂载 BoardLayoutEditor，支持导入/导出配置
- [x] 3.3 创建初始布局配置 `layout.config.json`（8×6 网格 + 抽牌堆/弃牌堆/魔力轨道）
- [x] 3.4 建立最小配置数据：棋盘尺寸、初始部署、示例卡牌/派系
- [x] 3.5 完成最小可玩 Board UI（基础操作入口与回合/魔力信息）
- [x] 3.6 重构 UI 布局：右侧回合进度、左下玩家信息、右上对手信息、底部提示横幅
- [x] 3.7 手牌区改为点击选中模式（非拖拽），使用精灵图显示卡牌
  - 已完成：HandArea 改为点击选中模式
  - 卡牌渲染：使用 CardSprite 组件（精灵图），无精灵图时降级为占位渲染
  - 交互模式：点击选中 → 点击目标位置放置
- [ ] 3.8 导入完整卡牌数据：精灵图配置 + 卡牌属性
  - 需要：每张卡的 atlasId + frameIndex 映射
  - 需要：完整卡牌属性（名称、费用、生命、攻击力、能力）
  - **等待用户提供**
- [x] 3.9 实现召唤流程：选中手牌 → 高亮可召唤位置 → 点击放置
  - 已完成：选中手牌后高亮绿色可召唤位置，点击放置
- [x] 3.10 实现攻击/移动流程的视觉反馈
  - 已完成：移动阶段蓝色高亮可移动位置，攻击阶段红色高亮可攻击目标

## 4. 待完成功能（MVP 剩余）
- [x] 4.1 建造阶段：BUILD_STRUCTURE 命令实现
  - 已完成：领域层命令/事件/验证
  - 已完成：UI 高亮可建造位置（紫色）
  - 已完成：点击放置建筑
- [x] 4.2 事件卡：PLAY_EVENT 命令实现
  - 已完成：根据事件卡的 playPhase 判断可施放阶段
  - 已完成：支付费用、执行效果、弃置
  - 已完成：主动事件（ACTIVE）放入主动区域
  - 已完成：主动事件下回合开始弃置（在 flowHooks.onPhaseEnter 中）
  - 已完成：事件卡 UI（手牌中显示可施放状态 - 绿色边框高亮）
- [x] 4.3 骰子掷骰逻辑
  - 已完成：创建骰子配置（`config/dice.ts`）
  - 已完成：实现 rollDice/countHits 函数
  - 已完成：攻击命令使用真正的骰子掷骰
  - 已完成：骰子掷骰 UI 动画（DiceResultOverlay 组件）
- [x] 4.4 单位摧毁与魔力奖励
  - 已完成：摧毁敌方卡牌时 +1 魔力
  - 已完成：摧毁的卡牌加入所有者弃牌堆
  - 已完成：卡牌摧毁动画（DestroyEffect 组件 - 爆炸粒子效果）
- [x] 4.5 胜负判定 UI
  - 已完成：EndgameOverlay 组件已接入

## 5. 收尾
- [x] 5.1 更新 i18n 文案与缩略图，启用 manifest 并生成清单
- [x] 5.2 补充测试：阶段门禁、移动/攻击规则、魔力范围、胜负判定
- [x] 5.3 运行测试与校验脚本（vitest + generate:manifests）
- [x] 5.4 完整游戏流程测试（full-game.test.ts）
  - 已完成：游戏能从开始跑到一方召唤师死亡
  - 已完成：胜负判定正确触发
  - 测试通过：4 个测试用例全部通过
- [x] 5.5 补充命令级错误测试（符合 docs/automated-testing.md 要求）
  - 已完成：召唤错误（非召唤阶段、魔力不足、无效位置、无效卡牌）
  - 已完成：建造错误（非建造阶段、魔力不足、无效卡牌）
  - 已完成：移动错误（次数用完、已移动、敌方单位）
  - 已完成：攻击错误（次数用完、已攻击、敌方单位）
  - 已完成：事件卡错误（魔力不足）
  - 测试通过：57 个测试用例全部通过
- [ ] 5.6 修复 E2E 测试（联机模式需要后端服务）

## 6. 技能效果实装（亡灵法师阵营）
> 当前 MVP 核心流程已完成，技能效果为增强功能

### 已完成
- [x] 6.4 古尔-达斯 - `rage`（暴怒）✅
  - 每有1点伤害，战力+1
  - 实现：`calculateEffectiveStrength()` 在攻击时自动计算
- [x] 6.5 亡灵战士 - `power_boost`（力量强化）✅
  - 每点充能战力+1（最多+5）
  - 实现：`calculateEffectiveStrength()` 在攻击时自动计算
- [x] 6.6 地狱火教徒 - `sacrifice`（献祭）✅
  - 被消灭后对相邻敌方单位各造成1点伤害
  - 实现：`triggerAbilities('onDeath', ...)` 在单位被消灭时触发
- [x] 6.5 亡灵战士 - `blood_rage_decay`（血腥狂怒衰减）✅
  - 回合结束移除2点充能
  - 实现：`flowHooks.onPhaseExit` 在抽牌阶段结束时触发 `onTurnEnd` 技能

### 部分完成（需要 UI 交互）
- [ ] 6.1 召唤师 - `revive_undead`（复活死灵）
  - 每回合一次，召唤阶段，对自己造成2点伤害，从弃牌堆拿取亡灵单位放置到相邻位置
  - 状态：技能定义完成，需要 UI 选择弃牌堆卡牌
- [ ] 6.2 伊路特-巴尔 - `fire_sacrifice_summon`（火祀召唤）
  - 召唤时必须消灭一个友方单位，替换被消灭单位的位置
  - 状态：技能定义完成，需要 UI 选择友方单位
- [ ] 6.3 德拉戈斯 - `life_drain`（吸取生命）
  - 攻击前可消灭2格内友方单位，本次攻击战力翻倍
  - 状态：技能定义完成，需要 UI 选择友方单位
- [ ] 6.5 亡灵战士 - `blood_rage`（血腥狂怒充能）
  - 回合中有单位被消灭时充能
  - 状态：技能定义完成，`onUnitDestroyed` 触发已集成到攻击流程
- [ ] 6.7 亡灵疫病体 - `soulless`（无魂）
  - 消灭敌方单位时不获得魔力
  - 状态：技能定义完成，需要在伤害结算时检查标记
- [ ] 6.7 亡灵疫病体 - `infection`（感染）
  - 消灭单位后可用弃牌堆的疫病体替换被消灭单位
  - 状态：技能定义完成，需要 UI 选择弃牌堆卡牌
- [ ] 6.8 亡灵弓箭手 - `soul_transfer`（灵魂转移）
  - 3格内单位在你回合被消灭后，可用本单位替换被消灭单位的位置
  - 状态：技能定义完成，`onUnitDestroyed` 触发已集成到攻击流程
