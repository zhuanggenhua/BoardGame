## ADDED Requirements

### Requirement: 战场网格与初始部署
系统 SHALL 以配置驱动创建战场网格，并根据阵营配置放置召唤师、城门与起始单位；同时按先后手设置初始魔力值。

#### Scenario: 初始化战场
- **WHEN** 游戏进入 setup
- **THEN** 战场网格创建完成
- **AND** 每位玩家的召唤师/城门/起始单位位于配置位置
- **AND** 先手魔力为 2，后手魔力为 3

### Requirement: 回合阶段流程
系统 SHALL 使用阶段机制按“召唤→移动→建造→攻击→魔力→抽牌”顺序推进，并限制命令只能在对应阶段执行。

#### Scenario: 阶段顺序与门禁
- **GIVEN** 当前处于召唤阶段
- **WHEN** 执行阶段推进命令
- **THEN** 阶段进入移动阶段
- **AND** 非移动阶段的移动命令被拒绝

### Requirement: 召唤规则
系统 SHALL 允许玩家在召唤阶段支付魔力并将单位放置于己方城门相邻空格；召唤的单位当回合可移动与攻击。

#### Scenario: 正常召唤
- **GIVEN** 玩家有足够魔力且城门相邻空格为空
- **WHEN** 玩家执行召唤命令
- **THEN** 单位被放置在相邻空格
- **AND** 玩家魔力减少相应费用

### Requirement: 移动规则
系统 SHALL 允许玩家在移动阶段移动最多 3 个单位，每个单位最多 2 格，且只能水平/垂直移动，不能穿越其他卡牌；建筑不可移动。

#### Scenario: 禁止对角线移动
- **GIVEN** 玩家在移动阶段尝试对角线移动
- **WHEN** 提交移动命令
- **THEN** 系统拒绝该命令并保持状态不变

### Requirement: 建造规则
系统 SHALL 允许玩家在建造阶段支付费用并放置建筑，位置仅限召唤师相邻或己方后 3 排。

#### Scenario: 建造位置限制
- **GIVEN** 目标位置不在允许区域
- **WHEN** 玩家提交建造命令
- **THEN** 系统拒绝建造并提示位置无效

### Requirement: 攻击解析
系统 SHALL 在攻击阶段允许最多 3 个单位攻击；近战仅相邻目标、远程直线 ≤3 格；掷骰数=力量值；仅匹配符号造成伤害。

#### Scenario: 远程攻击掷骰
- **GIVEN** 远程单位攻击直线 2 格目标
- **WHEN** 掷出与远程符号匹配的结果
- **THEN** 目标受到等于匹配结果数量的伤害

### Requirement: 伤害与摧毁奖励
系统 SHALL 记录伤害并在生命值降至 0 时摧毁卡牌；摧毁敌方卡牌时获得 1 点魔力。

#### Scenario: 摧毁奖励
- **GIVEN** 玩家摧毁一张敌方单位卡
- **WHEN** 卡牌生命值降至 0
- **THEN** 该卡牌被弃置
- **AND** 摧毁方获得 1 点魔力

### Requirement: 不活动惩罚
系统 SHALL 在攻击阶段结束时若未对任何敌方卡牌进行攻击，则对当前玩家召唤师造成 1 点伤害。

#### Scenario: 未攻击触发惩罚
- **GIVEN** 攻击阶段内未声明任何攻击
- **WHEN** 阶段结束
- **THEN** 当前玩家召唤师受到 1 点伤害

### Requirement: 魔力阶段与轨道限制
系统 SHALL 允许玩家在魔力阶段弃置任意数量卡牌以获得等量魔力，魔力范围为 0-15。

#### Scenario: 魔力上限限制
- **GIVEN** 玩家当前魔力为 15
- **WHEN** 玩家弃置卡牌尝试获得魔力
- **THEN** 魔力保持为 15 不再增加

### Requirement: 抽牌阶段
系统 SHALL 在抽牌阶段将手牌补至 5 张；若牌堆为空或不足，则抽取剩余卡牌且不洗弃牌堆。

#### Scenario: 牌堆不足抽牌
- **GIVEN** 玩家手牌为 2 且牌堆只剩 2 张
- **WHEN** 抽牌阶段开始
- **THEN** 玩家仅抽到 2 张并结束抽牌

### Requirement: 胜利条件
系统 SHALL 在对方召唤师被摧毁时判定胜利；若双方召唤师同时被摧毁，则当前回合玩家获胜。

#### Scenario: 召唤师被摧毁
- **GIVEN** 对方召唤师生命值降至 0
- **WHEN** 伤害结算完成
- **THEN** 系统判定当前玩家获胜
